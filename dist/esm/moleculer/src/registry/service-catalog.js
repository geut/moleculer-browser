import e from"lodash";import t from"../utils.js";import r from"./service-item.js";const{removeFromArray:s}=t;var i=class{constructor(e,t){this.registry=e,this.broker=t,this.logger=e.logger,this.services=[]}add(e,t,s){const i=new r(e,t,s);return this.services.push(i),i}has(e,t){return null!=this.services.find((r=>r.equals(e,t)))}get(e,t){return this.services.find((r=>r.equals(e,t)))}list({onlyLocal:t=!1,onlyAvailable:r=!1,skipInternal:s=!1,withActions:i=!1,withEvents:n=!1,grouping:o=!1}){let a=[];return this.services.forEach((l=>{if(s&&/^\$/.test(l.name))return;if(t&&!l.local)return;if(r&&!l.node.available)return;let c;if(o&&(c=a.find((e=>e.fullName==l.fullName))),c)-1===c.nodes.indexOf(l.node.id)&&c.nodes.push(l.node.id);else{let t={name:l.name,version:l.version,fullName:l.fullName,settings:l.settings,metadata:l.metadata,local:l.local,available:l.node.available};o?t.nodes=[l.node.id]:t.nodeID=l.node.id,i&&(t.actions={},e.forIn(l.actions,(r=>{r.protected||(t.actions[r.name]=e.omit(r,["handler","remoteHandler","service"]))}))),n&&(t.events={},e.forIn(l.events,(r=>{/^\$/.test(r.name)||(t.events[r.name]=e.omit(r,["handler","remoteHandler","service"]))}))),a.push(t)}})),a}getLocalNodeServices(){let t=[];return this.services.forEach((r=>{if(!r.local)return;let s={name:r.name,version:r.version,fullName:r.fullName,settings:r.settings,metadata:r.metadata,dependencies:r.dependencies,actions:{}};e.forIn(r.actions,(t=>{t.protected||(s.actions[t.name]=e.omit(t,["handler","remoteHandler","service"]))})),s.events={},e.forIn(r.events,(t=>{s.events[t.name]=e.omit(t,["handler","remoteHandler","service"])})),t.push(s)})),t}removeAllByNodeID(t){e.remove(this.services,(e=>{if(e.node.id==t)return this.registry.actions.removeByService(e),this.registry.events.removeByService(e),!0}))}remove(e,t){let r=this.get(e,t);r&&(this.registry.actions.removeByService(r),this.registry.events.removeByService(r),s(this.services,r))}};export default i;
//# sourceMappingURL=service-catalog.js.map

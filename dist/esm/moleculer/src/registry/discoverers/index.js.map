{"version":3,"file":"index.js","sources":["../../../../../../src/moleculer/src/registry/discoverers/index.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2020 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { BrokerOptionsError } = require(\"../../errors\");\nconst { isObject, isString } = require(\"../../utils\");\n\nconst Discoverers = {\n\tBase: require(\"./base\"),\n\tLocal: require(\"./local\"),\n\tEtcd3: require(\"./etcd3\"),\n\tRedis: require(\"./redis\")\n};\n\nfunction getByName(name) {\n\t/* istanbul ignore next */\n\tif (!name)\n\t\treturn null;\n\n\tlet n = Object.keys(Discoverers).find(n => n.toLowerCase() == name.toLowerCase());\n\tif (n)\n\t\treturn Discoverers[n];\n}\n\n/**\n * Resolve discoverer by name\n *\n * @param {object|string} opt\n * @returns {Discoverer}\n * @memberof ServiceBroker\n */\nfunction resolve(opt) {\n\tif (opt instanceof Discoverers.Base) {\n\t\treturn opt;\n\t} else if (isString(opt)) {\n\t\tlet DiscovererClass = getByName(opt);\n\t\tif (DiscovererClass)\n\t\t\treturn new DiscovererClass();\n\n\t\tif (opt.startsWith(\"redis://\"))\n\t\t\treturn new Discoverers.Redis(opt);\n\n\t\tif (opt.startsWith(\"etcd3://\"))\n\t\t\treturn new Discoverers.Etcd3(opt);\n\n\t\tthrow new BrokerOptionsError(`Invalid Discoverer type '${opt}'.`, { type: opt });\n\n\t} else if (isObject(opt)) {\n\t\tlet DiscovererClass = getByName(opt.type || \"Local\");\n\t\tif (DiscovererClass)\n\t\t\treturn new DiscovererClass(opt.options);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid Discoverer type '${opt.type}'.`, { type: opt.type });\n\t}\n\n\treturn new Discoverers.Local();\n}\n\nfunction register(name, value) {\n\tDiscoverers[name] = value;\n}\n\nmodule.exports = Object.assign(Discoverers, { resolve, register });\n"],"names":["require$$0","require$$1","require$$2","require$$3","require$$4","require$$5"],"mappings":";;;;;;AAQA,MAAM,EAAE,kBAAkB,EAAE,GAAGA,MAAuB,CAAC;AACvD,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAGC,OAAsB,CAAC;AACtD;AACA,MAAM,WAAW,GAAG;AACpB,CAAC,IAAI,EAAEC,IAAiB;AACxB,CAAC,KAAK,EAAEC,KAAkB;AAC1B,CAAC,KAAK,EAAEC,WAAkB;AAC1B,CAAC,KAAK,EAAEC,WAAkB;AAC1B,CAAC,CAAC;AACF;AACA,SAAS,SAAS,CAAC,IAAI,EAAE;AACzB;AACA,CAAC,IAAI,CAAC,IAAI;AACV,EAAE,OAAO,IAAI,CAAC;AACd;AACA,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;AACnF,CAAC,IAAI,CAAC;AACN,EAAE,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC;AACxB,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,OAAO,CAAC,GAAG,EAAE;AACtB,CAAC,IAAI,GAAG,YAAY,WAAW,CAAC,IAAI,EAAE;AACtC,EAAE,OAAO,GAAG,CAAC;AACb,EAAE,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B,EAAE,IAAI,eAAe,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC;AACvC,EAAE,IAAI,eAAe;AACrB,GAAG,OAAO,IAAI,eAAe,EAAE,CAAC;AAChC;AACA,EAAE,IAAI,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC;AAChC,GAAG,OAAO,IAAI,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACrC;AACA,EAAE,IAAI,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC;AAChC,GAAG,OAAO,IAAI,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACrC;AACA,EAAE,MAAM,IAAI,kBAAkB,CAAC,CAAC,yBAAyB,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AACnF;AACA,EAAE,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B,EAAE,IAAI,eAAe,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,IAAI,OAAO,CAAC,CAAC;AACvD,EAAE,IAAI,eAAe;AACrB,GAAG,OAAO,IAAI,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AAC3C;AACA,GAAG,MAAM,IAAI,kBAAkB,CAAC,CAAC,yBAAyB,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;AAC9F,EAAE;AACF;AACA,CAAC,OAAO,IAAI,WAAW,CAAC,KAAK,EAAE,CAAC;AAChC,CAAC;AACD;AACA,SAAS,QAAQ,CAAC,IAAI,EAAE,KAAK,EAAE;AAC/B,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;AAC3B,CAAC;AACD;eACc,GAAG,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE;;;;"}
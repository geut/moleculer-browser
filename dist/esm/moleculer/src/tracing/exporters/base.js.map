{"version":3,"file":"base.js","sources":["../../../../../../src/moleculer/src/tracing/exporters/base.js"],"sourcesContent":["\"use strict\";\n\nconst _ = require(\"lodash\");\nconst { isObject } = require(\"../../utils\");\n\n/**\n * Abstract Trace Exporter\n *\n * @class BaseTraceExporter\n */\nclass BaseTraceExporter {\n\n\t/**\n\t * Creates an instance of BaseTraceExporter.\n\t * @param {Object?} opts\n\t * @memberof BaseTraceExporter\n\t */\n\tconstructor(opts) {\n\t\tthis.opts = opts || {};\n\t\tthis.Promise = Promise; // default promise before logger is initialized\n\t}\n\n\t/**\n\t * Initialize Trace Exporter.\n\t *\n\t * @param {Tracer} tracer\n\t * @memberof BaseTraceExporter\n\t */\n\tinit(tracer) {\n\t\tthis.tracer = tracer;\n\t\tthis.broker = tracer.broker;\n\t\tthis.Promise = this.broker.Promise;\n\t\tthis.logger = this.opts.logger || this.tracer.logger;\n\t}\n\n\t/**\n\t * Stop Trace exporter\n\t */\n\tstop() {\n\t\t// Not implemented\n\t}\n\n\t/**\n\t * Span is started.\n\t *\n\t * @param {Span} span\n\t * @memberof BaseTraceExporter\n\t */\n\tspanStarted(/*span*/) {\n\t\t// Not implemented\n\t}\n\n\t/**\n\t * Span is finished.\n\t *\n\t * @param {Span} span\n\t * @memberof BaseTraceExporter\n\t */\n\tspanFinished(/*span*/) {\n\t\t// Not implemented\n\t}\n\n\t/**\n\t * Flattening tags to one-level object.\n\t * E.g.\n\t *  **From:**\n\t * \t```js\n\t * \t{\n\t * \t\terror: {\n\t * \t\t\tname: \"MoleculerError\"\n\t * \t\t}\n\t * \t}\n\t *  ```\n\t *\n\t * \t**To:**\n\t * \t```js\n\t *  {\n\t * \t\t\"error.name\": \"MoleculerError\"\n\t *  }\n\t *  ```\n\t *\n\t * @param {Object} obj\n\t * @param {boolean} [convertToString=false]\n\t * @param {string} [path=\"\"]\n\t * @returns {Object}\n\t * @memberof BaseTraceExporter\n\t */\n\tflattenTags(obj, convertToString = false, path = \"\") {\n\t\tif (!obj) return null;\n\n\t\treturn Object.keys(obj).reduce((res, k) => {\n\t\t\tconst o = obj[k];\n\t\t\tconst pp = (path ? path + \".\" : \"\") + k;\n\n\t\t\tif (isObject(o))\n\t\t\t\tObject.assign(res, this.flattenTags(o, convertToString, pp));\n\t\t\telse if (o !== undefined) {\n\t\t\t\tres[pp] = convertToString ? String(o) : o;\n\t\t\t}\n\n\t\t\treturn res;\n\t\t}, {});\n\t}\n\n\t/**\n\t * Convert Error to POJO.\n\t *\n\t * @param {Error} err\n\t * @returns {Object}\n\t * @memberof BaseTraceExporter\n\t */\n\terrorToObject(err) {\n\t\tif (!err) return null;\n\n\t\treturn _.pick(err, this.tracer.opts.errorFields);\n\t}\n}\n\nmodule.exports = BaseTraceExporter;\n"],"names":["require$$0"],"mappings":";;;AAGA,MAAM,EAAE,QAAQ,EAAE,GAAGA,OAAsB,CAAC;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,iBAAiB,CAAC;AACxB;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,WAAW,CAAC,IAAI,EAAE;AACnB,EAAE,IAAI,CAAC,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AACzB,EAAE,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;AACzB,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,IAAI,CAAC,MAAM,EAAE;AACd,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACvB,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;AAC9B,EAAE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;AACrC,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;AACvD,EAAE;AACF;AACA;AACA;AACA;AACA,CAAC,IAAI,GAAG;AACR;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,WAAW,WAAW;AACvB;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,YAAY,WAAW;AACxB;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,WAAW,CAAC,GAAG,EAAE,eAAe,GAAG,KAAK,EAAE,IAAI,GAAG,EAAE,EAAE;AACtD,EAAE,IAAI,CAAC,GAAG,EAAE,OAAO,IAAI,CAAC;AACxB;AACA,EAAE,OAAO,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC,KAAK;AAC7C,GAAG,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;AACpB,GAAG,MAAM,EAAE,GAAG,CAAC,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,EAAE,IAAI,CAAC,CAAC;AAC3C;AACA,GAAG,IAAI,QAAQ,CAAC,CAAC,CAAC;AAClB,IAAI,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,EAAE,eAAe,EAAE,EAAE,CAAC,CAAC,CAAC;AACjE,QAAQ,IAAI,CAAC,KAAK,SAAS,EAAE;AAC7B,IAAI,GAAG,CAAC,EAAE,CAAC,GAAG,eAAe,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AAC9C,IAAI;AACJ;AACA,GAAG,OAAO,GAAG,CAAC;AACd,GAAG,EAAE,EAAE,CAAC,CAAC;AACT,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,aAAa,CAAC,GAAG,EAAE;AACpB,EAAE,IAAI,CAAC,GAAG,EAAE,OAAO,IAAI,CAAC;AACxB;AACA,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AACnD,EAAE;AACF,CAAC;AACD;QACc,GAAG;;;;"}
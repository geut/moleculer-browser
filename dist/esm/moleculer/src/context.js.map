{"version":3,"file":"context.js","sources":["../../../../src/moleculer/src/context.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst util = require(\"util\");\nconst { isString } = require(\"./utils\");\nconst _ = require(\"lodash\");\nconst { RequestSkippedError, MaxCallLevelError } = require(\"./errors\");\n\n/**\n * Merge metadata\n *\n * @param {Object} newMeta\n *\n * @private\n * @memberof Context\n */\nfunction mergeMeta(ctx, newMeta) {\n\tif (newMeta)\n\t\tObject.assign(ctx.meta, newMeta);\n\treturn ctx.meta;\n}\n\n/**\n * Context class for action calls\n *\n * @property {String} id - Context ID\n * @property {ServiceBroker} broker - Broker instance\n * @property {Action} action - Action definition\n * @property {String} [nodeID=null] - Node ID\n * @property {String} parentID - Parent Context ID\n * @property {Boolean} tracing - Enable tracing\n * @property {Number} [level=1] - Level of context\n *\n * @class Context\n */\nclass Context {\n\n\t/**\n\t * Creates an instance of Context.\n\t *\n\t * @param {ServiceBroker} broker - Broker instance\n\t * @param {Endpoint} endpoint\n\t *\n\t * @memberof Context\n\t */\n\tconstructor(broker, endpoint) {\n\n\t\tthis.broker = broker;\n\t\tif (this.broker) {\n\t\t\tthis.nodeID = this.broker.nodeID;\n\t\t\tthis.id = this.broker.generateUid();\n\t\t} else {\n\t\t\tthis.nodeID = null;\n\t\t}\n\n\t\tif (endpoint) {\n\t\t\tthis.setEndpoint(endpoint);\n\t\t} else {\n\t\t\tthis.endpoint = null;\n\t\t\tthis.service = null;\n\t\t\tthis.action = null;\n\t\t\tthis.event = null;\n\t\t}\n\n\t\t// The emitted event \"user.created\" because `ctx.event.name` can be \"user.**\"\n\t\tthis.eventName = null;\n\t\t// Type of event (\"emit\" or \"broadcast\")\n\t\tthis.eventType = null;\n\t\t// The groups of event\n\t\tthis.eventGroups = null;\n\n\t\tthis.options = {\n\t\t\ttimeout: null,\n\t\t\tretries: null,\n\t\t};\n\n\t\tthis.parentID = null;\n\t\tthis.caller = null;\n\n\t\tthis.level = 1;\n\n\t\tthis.params = null;\n\t\tthis.meta = {};\n\t\tthis.locals = {};\n\n\t\tthis.requestID = this.id;\n\n\t\tthis.tracing = null;\n\t\tthis.span = null;\n\t\tthis._spanStack = [];\n\n\t\tthis.needAck = null;\n\t\tthis.ackID = null;\n\n\t\t//this.startTime = null;\n\t\t//his.startHrTime = null;\n\t\t//this.stopTime = null;\n\t\t//this.duration = null;\n\n\t\t//this.error = null;\n\t\tthis.cachedResult = false;\n\t}\n\n\t/**\n\t * Create a new Context instance\n\t *\n\t * @param {ServiceBroker} broker\n\t * @param {Endpoint} endpoint\n\t * @param {Object?} params\n\t * @param {Object} opts\n\t * @returns {Context}\n\t *\n\t * @static\n\t * @memberof Context\n\t */\n\tstatic create(broker, endpoint, params, opts = {}) {\n\t\tconst ctx = new broker.ContextFactory(broker, endpoint);\n\n\t\tif (endpoint != null)\n\t\t\tctx.setEndpoint(endpoint);\n\n\t\tif (params != null) {\n\t\t\tlet cloning = broker ? broker.options.contextParamsCloning : false;\n\t\t\tif (opts.paramsCloning != null)\n\t\t\t\tcloning = opts.paramsCloning;\n\t\t\tctx.setParams(params, cloning);\n\t\t}\n\n\t\t//Object.assign(ctx.options, opts);\n\t\tctx.options = opts;\n\n\t\t// RequestID\n\t\tif (opts.requestID != null)\n\t\t\tctx.requestID = opts.requestID;\n\t\telse if (opts.parentCtx != null && opts.parentCtx.requestID != null)\n\t\t\tctx.requestID = opts.parentCtx.requestID;\n\n\t\t// Meta\n\t\tif (opts.parentCtx != null && opts.parentCtx.meta != null)\n\t\t\tctx.meta = Object.assign({}, opts.parentCtx.meta || {}, opts.meta || {});\n\t\telse if (opts.meta != null)\n\t\t\tctx.meta = opts.meta;\n\n\t\t// ParentID, Level, Caller, Tracing\n\t\tif (opts.parentCtx != null) {\n\t\t\tctx.tracing = opts.parentCtx.tracing;\n\t\t\tctx.level = opts.parentCtx.level + 1;\n\n\t\t\tif (opts.parentCtx.span)\n\t\t\t\tctx.parentID = opts.parentCtx.span.id;\n\t\t\telse\n\t\t\t\tctx.parentID = opts.parentCtx.id;\n\n\t\t\tif (opts.parentCtx.service)\n\t\t\t\tctx.caller = opts.parentCtx.service.fullName;\n\t\t}\n\n\t\t// caller\n\t\tif (opts.caller) {\n\t\t\tctx.caller = opts.caller;\n\t\t}\n\n\t\t// Parent span\n\t\tif (opts.parentSpan != null) {\n\t\t\tctx.parentID = opts.parentSpan.id;\n\t\t\tctx.requestID = opts.parentSpan.traceID;\n\t\t\tctx.tracing = opts.parentSpan.sampled;\n\t\t}\n\n\t\t// Event acknowledgement\n\t\tif (opts.needAck) {\n\t\t\tctx.needAck = opts.needAck;\n\t\t}\n\n\t\treturn ctx;\n\t}\n\n\t/**\n\t * Copy itself without ID.\n\t * @param {Endpoint} ep\n\t * @returns {Context}\n\t */\n\tcopy(ep) {\n\t\tconst newCtx = new this.constructor(this.broker);\n\n\t\tnewCtx.nodeID = this.nodeID;\n\t\tnewCtx.setEndpoint(ep || this.endpoint);\n\t\tnewCtx.options = this.options;\n\t\tnewCtx.parentID = this.parentID;\n\t\tnewCtx.caller = this.caller;\n\t\tnewCtx.level = this.level;\n\t\tnewCtx.params = this.params;\n\t\tnewCtx.meta = this.meta;\n\t\tnewCtx.locals = this.locals;\n\t\tnewCtx.requestID = this.requestID;\n\t\tnewCtx.tracing = this.tracing;\n\t\tnewCtx.span = this.span;\n\t\tnewCtx.needAck = this.needAck;\n\t\tnewCtx.ackID = this.ackID;\n\t\tnewCtx.eventName = this.eventName;\n\t\tnewCtx.eventType = this.eventType;\n\t\tnewCtx.eventGroups = this.eventGroups;\n\n\t\tnewCtx.cachedResult = this.cachedResult;\n\n\t\treturn newCtx;\n\t}\n\n\t/**\n\t * Set endpoint of context\n\t *\n\t * @param {Endpoint} endpoint\n\t * @memberof Context\n\t */\n\tsetEndpoint(endpoint) {\n\t\tthis.endpoint = endpoint;\n\t\tif (endpoint) {\n\t\t\tthis.nodeID = endpoint.id;\n\t\t\tif (endpoint.action) {\n\t\t\t\tthis.action = endpoint.action;\n\t\t\t\tthis.service = this.action.service;\n\t\t\t\tthis.event = null;\n\t\t\t} else if (endpoint.event) {\n\t\t\t\tthis.event =  endpoint.event;\n\t\t\t\tthis.service = this.event.service;\n\t\t\t\tthis.action = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Set params of context\n\t *\n\t * @param {Object} newParams\n\t * @param {Boolean} cloning\n\t *\n\t * @memberof Context\n\t */\n\tsetParams(newParams, cloning = false) {\n\t\tif (cloning && newParams)\n\t\t\tthis.params = Object.assign({}, newParams);\n\t\telse\n\t\t\tthis.params = newParams;\n\t}\n\n\t/**\n\t * Call an other action. It creates a sub-context.\n\t *\n\t * @param {String} actionName\n\t * @param {Object?} params\n\t * @param {Object?} opts\n\t * @returns {Promise}\n\t *\n\t * @example <caption>Call an other service with params & options</caption>\n\t * ctx.call(\"posts.get\", { id: 12 }, { timeout: 1000 });\n\t *\n\t * @memberof Context\n\t */\n\tcall(actionName, params, _opts) {\n\t\tconst opts = Object.assign({\n\t\t\tparentCtx: this\n\t\t}, _opts);\n\n\t\tif (this.options.timeout > 0 && this.startHrTime) {\n\t\t\t// Distributed timeout handling. Decrementing the timeout value with the elapsed time.\n\t\t\t// If the timeout below 0, skip the call.\n\t\t\tconst diff = process.hrtime(this.startHrTime);\n\t\t\tconst duration = (diff[0] * 1e3) + (diff[1] / 1e6);\n\t\t\tconst distTimeout = this.options.timeout - duration;\n\n\t\t\tif (distTimeout <= 0) {\n\t\t\t\treturn this.broker.Promise.reject(new RequestSkippedError({ action: actionName, nodeID: this.broker.nodeID }));\n\t\t\t}\n\n\t\t\tif (!opts.timeout || distTimeout < opts.timeout)\n\t\t\t\topts.timeout = distTimeout;\n\t\t}\n\n\t\t// Max calling level check to avoid calling loops\n\t\tif (this.broker.options.maxCallLevel > 0 && this.level >= this.broker.options.maxCallLevel) {\n\t\t\treturn this.broker.Promise.reject(new MaxCallLevelError({ nodeID: this.broker.nodeID, level: this.level }));\n\t\t}\n\n\t\tlet p = this.broker.call(actionName, params, opts);\n\n\t\t// Merge metadata with sub context metadata\n\t\treturn p.then(res => {\n\t\t\tif (p.ctx)\n\t\t\t\tmergeMeta(this, p.ctx.meta);\n\n\t\t\treturn res;\n\t\t}).catch(err => {\n\t\t\tif (p.ctx)\n\t\t\t\tmergeMeta(this, p.ctx.meta);\n\n\t\t\treturn this.broker.Promise.reject(err);\n\t\t});\n\t}\n\n\tmcall(def, _opts) {\n\t\tconst opts = Object.assign({\n\t\t\tparentCtx: this\n\t\t}, _opts);\n\n\t\tif (this.options.timeout > 0 && this.startHrTime) {\n\t\t\t// Distributed timeout handling. Decrementing the timeout value with the elapsed time.\n\t\t\t// If the timeout below 0, skip the call.\n\t\t\tconst diff = process.hrtime(this.startHrTime);\n\t\t\tconst duration = (diff[0] * 1e3) + (diff[1] / 1e6);\n\t\t\tconst distTimeout = this.options.timeout - duration;\n\n\t\t\tif (distTimeout <= 0) {\n\t\t\t\tconst action = (Array.isArray(def) ? def : Object.values(def)).map(d => d.action).join(\", \");\n\t\t\t\treturn this.broker.Promise.reject(new RequestSkippedError({ action, nodeID: this.broker.nodeID }));\n\t\t\t}\n\n\t\t\tif (!opts.timeout || distTimeout < opts.timeout)\n\t\t\t\topts.timeout = distTimeout;\n\t\t}\n\n\t\t// Max calling level check to avoid calling loops\n\t\tif (this.broker.options.maxCallLevel > 0 && this.level >= this.broker.options.maxCallLevel) {\n\t\t\treturn this.broker.Promise.reject(new MaxCallLevelError({ nodeID: this.broker.nodeID, level: this.level }));\n\t\t}\n\n\t\tlet p = this.broker.mcall(def, opts);\n\n\t\t// Merge metadata with sub context metadata\n\t\treturn p.then(res => {\n\t\t\tif (Array.isArray(p.ctx) && p.ctx.length)\n\t\t\t\tp.ctx.forEach(ctx => mergeMeta(this, ctx.meta));\n\n\t\t\treturn res;\n\t\t}).catch(err => {\n\t\t\tif (Array.isArray(p.ctx) && p.ctx.length)\n\t\t\t\tp.ctx.forEach(ctx => mergeMeta(this, ctx.meta));\n\n\t\t\treturn this.broker.Promise.reject(err);\n\t\t});\n\t}\n\n\t/**\n\t * Emit an event (grouped & balanced global event)\n\t *\n\t * @param {string} eventName\n\t * @param {any?} payload\n\t * @param {Object?} opts\n\t * @returns {Promise}\n\t *\n\t * @example\n\t * ctx.emit(\"user.created\", { entity: user, creator: ctx.meta.user });\n\t *\n\t * @memberof Context\n\t */\n\temit(eventName, data, opts) {\n\t\tif (Array.isArray(opts) || isString(opts))\n\t\t\topts = { groups: opts };\n\t\telse if (opts == null)\n\t\t\topts = {};\n\n\t\tif (opts.groups && !Array.isArray(opts.groups))\n\t\t\topts.groups = [opts.groups];\n\n\t\topts.parentCtx = this;\n\t\treturn this.broker.emit(eventName, data, opts);\n\t}\n\n\t/**\n\t * Emit an event for all local & remote services\n\t *\n\t * @param {string} eventName\n\t * @param {any?} payload\n\t * @param {Object?} opts\n\t * @returns {Promise}\n\t *\n\t * @example\n\t * ctx.broadcast(\"user.created\", { entity: user, creator: ctx.meta.user });\n\t *\n\t * @memberof Context\n\t */\n\tbroadcast(eventName, data, opts) {\n\t\tif (Array.isArray(opts) || isString(opts))\n\t\t\topts = { groups: opts };\n\t\telse if (opts == null)\n\t\t\topts = {};\n\n\t\tif (opts.groups && !Array.isArray(opts.groups))\n\t\t\topts.groups = [opts.groups];\n\n\t\topts.parentCtx = this;\n\t\treturn this.broker.broadcast(eventName, data, opts);\n\t}\n\n\t/**\n\t * Start a new child tracing span.\n\t *\n\t * @param {String} name\n\t * @param {Object?} opts\n\t * @returns {Span}\n\t * @memberof Context\n\t */\n\tstartSpan(name, opts) {\n\t\tlet span;\n\t\tif (this.span) {\n\t\t\tspan = this.span.startSpan(name, Object.assign({ ctx: this }, opts));\n\t\t} else {\n\t\t\tspan = this.broker.tracer.startSpan(name, Object.assign({ ctx: this }, opts));\n\t\t}\n\n\t\tthis._spanStack.push(span);\n\t\tthis.span = span;\n\n\t\treturn span;\n\t}\n\n\t/**\n\t * Finish an active span.\n\t *\n\t * @param {Span} span\n\t * @param {Number?} time\n\t */\n\tfinishSpan(span, time) {\n\t\tif (!span.isActive()) return;\n\n\t\tspan.finish(time);\n\n\t\tconst idx = this._spanStack.findIndex(sp => sp == span);\n\t\tif (idx !== -1) {\n\t\t\tthis._spanStack.splice(idx, 1);\n\t\t\tthis.span = this._spanStack[this._spanStack.length - 1];\n\t\t} else {\n\t\t\t/* istanbul ignore next */\n\t\t\tthis.service.logger.warn(\"This span is not assigned to this context\", span);\n\t\t}\n\t}\n\n\t/**\n\t * Convert Context to a printable POJO object.\n\t */\n\ttoJSON() {\n\t\tconst res = _.pick(this, [\n\t\t\t\"id\",\n\t\t\t\"nodeID\",\n\t\t\t\"action.name\",\n\t\t\t\"event.name\",\n\t\t\t\"service.name\",\n\t\t\t\"service.version\",\n\t\t\t\"service.fullName\",\n\t\t\t\"options\",\n\t\t\t\"parentID\",\n\t\t\t\"caller\",\n\t\t\t\"level\",\n\t\t\t\"params\",\n\t\t\t\"meta\",\n\t\t\t//\"locals\",\n\t\t\t\"requestID\",\n\t\t\t\"tracing\",\n\t\t\t\"span\",\n\t\t\t\"needAck\",\n\t\t\t\"ackID\",\n\t\t\t\"eventName\",\n\t\t\t\"eventType\",\n\t\t\t\"eventGroups\",\n\t\t\t\"cachedResult\"\n\t\t]);\n\n\t\treturn res;\n\t}\n\n\t/* istanbul ignore next */\n\t[util.inspect.custom](depth, options) {\n\t\t// https://nodejs.org/docs/latest-v8.x/api/util.html#util_custom_inspection_functions_on_objects\n\t\tif (depth < 0) {\n\t\t\treturn options.stylize(\"[Context]\", \"special\");\n\t\t}\n\n\t\tconst inner = util.inspect(this.toJSON(), options);\n\t\treturn `${options.stylize(\"Context\", \"special\")}< ${inner} >`;\n\t}\n}\n\nmodule.exports = Context;\n"],"names":["require$$0","require$$1","process"],"mappings":"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"}
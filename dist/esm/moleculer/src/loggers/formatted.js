import e from"lodash";import t from"kleur";import r from"../utils.js";import o from"./base.js";import s from"util";const{isObject:n,isFunction:i}=r;var l=class extends o{constructor(t){super(t),this.opts=e.defaultsDeep(this.opts,{colors:!0,moduleColors:!1,formatter:"full",objectPrinter:null,autoPadding:!1}),this.maxPrefixLength=0}init(r){super.init(r),this.opts.colors||(t.enabled=!1),this.objectPrinter=this.opts.objectPrinter?this.opts.objectPrinter:e=>s.inspect(e,{showHidden:!1,depth:2,colors:t.enabled,breakLength:Number.POSITIVE_INFINITY}),this.levelColorStr=o.LEVELS.reduce(((r,o)=>(r[o]=function(e){switch(e){case"fatal":return t.red().inverse;case"error":return t.red;case"warn":return t.yellow;case"debug":return t.magenta;case"trace":return t.gray;default:return t.green}}(o)(e.padEnd(o.toUpperCase(),5)),r)),{}),this.opts.colors&&!0===this.opts.moduleColors&&(this.opts.moduleColors=["yellow","bold.yellow","cyan","bold.cyan","green","bold.green","magenta","bold.magenta","blue","bold.blue"])}getNextColor(e){if(this.opts.colors&&Array.isArray(this.opts.moduleColors)){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return this.opts.moduleColors[Math.abs(t)%this.opts.moduleColors.length]}return"grey"}padLeft(e){return this.opts.autoPadding?" ".repeat(this.maxPrefixLength-e):""}getFormatter(e){const r=this.opts.formatter,o=e&&e.mod?e.mod.toUpperCase():"",s=this.getNextColor(o).split(".").reduce(((e,t)=>e[t]||e()[t]),t)(o),l=e?t.grey(e.nodeID+"/")+s:"",a=e=>e.map((e=>n(e)||Array.isArray(e)?this.objectPrinter(e):e));if(i(r))return(t,o)=>r.call(this,t,o,e,{printArgs:a});if("json"==r)return t.enabled=!1,(t,r)=>[JSON.stringify({ts:Date.now(),level:t,msg:a(r).join(" "),...e})];if("jsonext"==r)return t.enabled=!1,(t,r)=>{const o={time:(new Date).toISOString(),level:t,message:"",...e};return r.length>0&&("object"==typeof r[0]?(Object.assign(o,r[0]),o.message=a(r.slice(1)).join(" ")):o.message=a(r).join(" ")),[JSON.stringify(o)]};if("simple"==r)return(e,t)=>[this.levelColorStr[e],"-",...a(t)];if("short"==r){const r=23+e.mod.length;return this.maxPrefixLength=Math.max(r,this.maxPrefixLength),(e,o)=>[t.grey(`[${(new Date).toISOString().substr(11)}]`),this.levelColorStr[e],s+this.padLeft(r)+t.grey(":"),...a(o)]}if("full"==r){const r=35+e.nodeID.length+e.mod.length;return this.maxPrefixLength=Math.max(r,this.maxPrefixLength),(e,o)=>[t.grey(`[${(new Date).toISOString()}]`),this.levelColorStr[e],l+this.padLeft(r)+t.grey(":"),...a(o)]}return(o,n)=>{const i=(new Date).toISOString();return[this.render(r,{timestamp:t.grey(i),time:t.grey(i.substr(11)),level:this.levelColorStr[o],nodeID:t.grey(e.nodeID),mod:s,msg:a(n).join(" ")})]}}render(e,t){return e.replace(/\{\s?(\w+)\s?\}/g,((e,r)=>t[r]||""))}};export default l;
//# sourceMappingURL=formatted.js.map

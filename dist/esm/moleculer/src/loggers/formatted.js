import e from"kleur";import t from"lodash";import r from"../utils.js";import o from"./base.js";import s from"util";const{isObject:n,isFunction:i}=r;var l=class extends o{constructor(e){super(e),this.opts=t.defaultsDeep(this.opts,{colors:!0,moduleColors:!1,formatter:"full",objectPrinter:null,autoPadding:!1}),this.maxPrefixLength=0}init(r){super.init(r),this.opts.colors||(e.enabled=!1),this.objectPrinter=this.opts.objectPrinter?this.opts.objectPrinter:t=>s.inspect(t,{showHidden:!1,depth:2,colors:e.enabled,breakLength:Number.POSITIVE_INFINITY}),this.levelColorStr=o.LEVELS.reduce(((r,o)=>(r[o]=function(t){switch(t){case"fatal":return e.red().inverse;case"error":return e.red;case"warn":return e.yellow;case"debug":return e.magenta;case"trace":return e.gray;default:return e.green}}(o)(t.padEnd(o.toUpperCase(),5)),r)),{}),this.opts.colors&&!0===this.opts.moduleColors&&(this.opts.moduleColors=["yellow","bold.yellow","cyan","bold.cyan","green","bold.green","magenta","bold.magenta","blue","bold.blue"])}getNextColor(e){if(this.opts.colors&&Array.isArray(this.opts.moduleColors)){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return this.opts.moduleColors[Math.abs(t)%this.opts.moduleColors.length]}return"grey"}padLeft(e){return this.opts.autoPadding?" ".repeat(this.maxPrefixLength-e):""}getFormatter(t){const r=this.opts.formatter,o=t&&t.mod?t.mod.toUpperCase():"",s=this.getNextColor(o).split(".").reduce(((e,t)=>e[t]||e()[t]),e)(o),l=t?e.grey(t.nodeID+"/")+s:"",a=e=>e.map((e=>n(e)||Array.isArray(e)?this.objectPrinter(e):e));if(i(r))return(e,o)=>r.call(this,e,o,t,{printArgs:a});if("json"==r)return e.enabled=!1,(e,r)=>[JSON.stringify({ts:Date.now(),level:e,msg:a(r).join(" "),...t})];if("jsonext"==r)return e.enabled=!1,(e,r)=>{const o={time:(new Date).toISOString(),level:e,message:"",...t};return r.length>0&&("object"==typeof r[0]?(Object.assign(o,r[0]),o.message=a(r.slice(1)).join(" ")):o.message=a(r).join(" ")),[JSON.stringify(o)]};if("simple"==r)return(e,t)=>[this.levelColorStr[e],"-",...a(t)];if("short"==r){const r=23+t.mod.length;return this.maxPrefixLength=Math.max(r,this.maxPrefixLength),(t,o)=>[e.grey(`[${(new Date).toISOString().substr(11)}]`),this.levelColorStr[t],s+this.padLeft(r)+e.grey(":"),...a(o)]}if("full"==r){const r=35+t.nodeID.length+t.mod.length;return this.maxPrefixLength=Math.max(r,this.maxPrefixLength),(t,o)=>[e.grey(`[${(new Date).toISOString()}]`),this.levelColorStr[t],l+this.padLeft(r)+e.grey(":"),...a(o)]}return(o,n)=>{const i=(new Date).toISOString();return[this.render(r,{timestamp:e.grey(i),time:e.grey(i.substr(11)),level:this.levelColorStr[o],nodeID:e.grey(t.nodeID),mod:s,msg:a(n).join(" ")})]}}render(e,t){return e.replace(/\{\s?(\w+)\s?\}/g,((e,r)=>t[r]||""))}};export default l;
//# sourceMappingURL=formatted.js.map

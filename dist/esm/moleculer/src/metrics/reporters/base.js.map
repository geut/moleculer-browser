{"version":3,"file":"base.js","sources":["../../../../../../src/moleculer/src/metrics/reporters/base.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst _ = require(\"lodash\");\nconst { match, isString } = require(\"../../utils\");\n\n/**\n * Metric reporter base class.\n *\n * @class BaseReporter\n */\nclass BaseReporter {\n\n\t/**\n\t * Creates an instance of BaseReporter.\n\t *\n\t * @param {Object} opts\n\t * @memberof BaseReporter\n\t */\n\tconstructor(opts) {\n\t\tthis.opts = _.defaultsDeep(opts, {\n\t\t\tincludes: null,\n\t\t\texcludes: null,\n\n\t\t\tmetricNamePrefix: null,\n\t\t\tmetricNameSuffix: null,\n\n\t\t\tmetricNameFormatter: null,\n\t\t\tlabelNameFormatter: null,\n\t\t});\n\n\t\tif (isString(this.opts.includes))\n\t\t\tthis.opts.includes = [this.opts.includes];\n\n\t\tif (isString(this.opts.excludes))\n\t\t\tthis.opts.excludes = [this.opts.excludes];\n\t}\n\n\t/**\n\t * Initialize reporter\n\t *\n\t * @param {MetricRegistry} registry\n\t * @memberof BaseReporter\n\t */\n\tinit(registry) {\n\t\tthis.registry = registry;\n\t\tthis.broker = this.registry.broker;\n\t\tthis.logger = this.registry.logger;\n\t}\n\n\t/**\n\t * Stop reporter\n\t *\n\t * @memberof BaseReporter\n\t */\n\tstop() {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Match the metric name. Check the `includes` & `excludes` patterns.\n\t *\n\t * @param {String} name\n\t * @returns {boolean}\n\t * @memberof BaseReporter\n\t */\n\tmatchMetricName(name) {\n\t\tif (Array.isArray(this.opts.includes)) {\n\t\t\tif (!this.opts.includes.some(pattern => match(name, pattern)))\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(this.opts.excludes)) {\n\t\t\tif (!this.opts.excludes.every(pattern => !match(name, pattern)))\n\t\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Format metric name. Add prefix, suffix and call custom formatter.\n\t *\n\t * @param {String} name\n\t * @returns {String}\n\t * @memberof BaseReporter\n\t */\n\tformatMetricName(name) {\n\t\tname = (this.opts.metricNamePrefix ? this.opts.metricNamePrefix : \"\") + name + (this.opts.metricNameSuffix ? this.opts.metricNameSuffix : \"\");\n\t\tif (this.opts.metricNameFormatter)\n\t\t\treturn this.opts.metricNameFormatter(name);\n\t\treturn name;\n\t}\n\n\t/**\n\t * Format label name. Call custom formatter.\n\t *\n\t * @param {String} name\n\t * @returns {String}\n\t * @memberof BaseReporter\n\t */\n\tformatLabelName(name) {\n\t\tif (this.opts.labelNameFormatter)\n\t\t\treturn this.opts.labelNameFormatter(name);\n\t\treturn name;\n\t}\n\n\t/**\n\t * Some metric has been changed.\n\t *\n\t * @param {BaseMetric} metric\n\t * @param {any} value\n\t * @param {Object} labels\n\t * @param {Number?} timestamp\n\t *\n\t * @memberof BaseReporter\n\t */\n\tmetricChanged(/*metric, value, labels, timestamp*/) {\n\t\t// Not implemented. Abstract method\n\t}\n}\n\nmodule.exports = BaseReporter;\n"],"names":["require$$0"],"mappings":"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"}
{"version":3,"file":"throttle.js","sources":["../../../../../src/moleculer/src/middlewares/throttle.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nmodule.exports = function throttleMiddleware(broker) {\n\n\tfunction wrapEventThrottleMiddleware(handler, event) {\n\t\tif (event.throttle > 0) {\n\t\t\tlet lastInvoke = 0;\n\n\t\t\treturn function throttleMiddleware(ctx) {\n\t\t\t\tconst now = Date.now();\n\t\t\t\tif (now - lastInvoke < event.throttle) {\n\t\t\t\t\treturn broker.Promise.resolve();\n\t\t\t\t}\n\t\t\t\tlastInvoke = now;\n\t\t\t\treturn handler(ctx);\n\t\t\t}.bind(this);\n\t\t}\n\t\treturn handler;\n\t}\n\n\treturn {\n\t\tname: \"Throttle\",\n\n\t\tlocalEvent: wrapEventThrottleMiddleware\n\t};\n};\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AAGA;YACc,GAAG,SAAS,kBAAkB,CAAC,MAAM,EAAE;AACrD;AACA,CAAC,SAAS,2BAA2B,CAAC,OAAO,EAAE,KAAK,EAAE;AACtD,EAAE,IAAI,KAAK,CAAC,QAAQ,GAAG,CAAC,EAAE;AAC1B,GAAG,IAAI,UAAU,GAAG,CAAC,CAAC;AACtB;AACA,GAAG,OAAO,SAAS,kBAAkB,CAAC,GAAG,EAAE;AAC3C,IAAI,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AAC3B,IAAI,IAAI,GAAG,GAAG,UAAU,GAAG,KAAK,CAAC,QAAQ,EAAE;AAC3C,KAAK,OAAO,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACrC,KAAK;AACL,IAAI,UAAU,GAAG,GAAG,CAAC;AACrB,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,CAAC;AACxB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAChB,GAAG;AACH,EAAE,OAAO,OAAO,CAAC;AACjB,EAAE;AACF;AACA,CAAC,OAAO;AACR,EAAE,IAAI,EAAE,UAAU;AAClB;AACA,EAAE,UAAU,EAAE,2BAA2B;AACzC,EAAE,CAAC;AACH;;;;"}
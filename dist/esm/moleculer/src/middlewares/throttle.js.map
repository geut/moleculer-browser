{"version":3,"file":"throttle.js","sources":["../../../../../src/moleculer/src/middlewares/throttle.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nmodule.exports = function throttleMiddleware(broker) {\n\n\tfunction wrapEventThrottleMiddleware(handler, event) {\n\t\tif (event.throttle > 0) {\n\t\t\tlet lastInvoke = 0;\n\n\t\t\treturn function throttleMiddleware(ctx) {\n\t\t\t\tconst now = Date.now();\n\t\t\t\tif (now - lastInvoke < event.throttle) {\n\t\t\t\t\treturn broker.Promise.resolve();\n\t\t\t\t}\n\t\t\t\tlastInvoke = now;\n\t\t\t\treturn handler(ctx);\n\t\t\t}.bind(this);\n\t\t}\n\t\treturn handler;\n\t}\n\n\treturn {\n\t\tname: \"Throttle\",\n\n\t\tlocalEvent: wrapEventThrottleMiddleware\n\t};\n};\n"],"names":["broker","name","localEvent","handler","event","throttle","lastInvoke","ctx","now","Date","Promise","resolve","bind","this"],"mappings":"eAQiB,SAA4BA,GAkB5C,MAAO,CACNC,KAAM,WAENC,WAnBD,SAAqCC,EAASC,GAC7C,GAAIA,EAAMC,SAAW,EAAG,CACvB,IAAIC,EAAa,EAEjB,OAAO,SAA4BC,GAClC,MAAMC,EAAMC,KAAKD,MACjB,OAAIA,EAAMF,EAAaF,EAAMC,SACrBL,EAAOU,QAAQC,WAEvBL,EAAaE,EACNL,EAAQI,KACdK,KAAKC,MAER,OAAOV"}
{"version":3,"file":"bulkhead.js","sources":["../../../../../src/moleculer/src/middlewares/bulkhead.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { QueueIsFullError } = require(\"../errors\");\nconst { METRIC }\t= require(\"../metrics\");\n\nmodule.exports = function bulkheadMiddleware(broker) {\n\n\tfunction wrapActionBulkheadMiddleware(handler, action) {\n\t\tconst service = action.service;\n\n\t\tconst opts = Object.assign({}, this.options.bulkhead || {}, action.bulkhead || {});\n\t\tif (opts.enabled) {\n\t\t\tconst queue = [];\n\t\t\tlet currentInFlight = 0;\n\n\t\t\t// Call the next request from the queue\n\t\t\tconst callNext = function callNext() {\n\t\t\t/* istanbul ignore next */\n\t\t\t\tif (queue.length == 0) return;\n\n\t\t\t\t/* istanbul ignore next */\n\t\t\t\tif (currentInFlight >= opts.concurrency) return;\n\n\t\t\t\tconst item = queue.shift();\n\n\t\t\t\tcurrentInFlight++;\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\n\t\t\t\thandler(item.ctx)\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\t\t\t\t\t\titem.resolve(res);\n\t\t\t\t\t\tcallNext();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\t\t\t\t\t\titem.reject(err);\n\t\t\t\t\t\tcallNext();\n\t\t\t\t\t});\n\t\t\t};\n\n\t\t\treturn function bulkheadMiddleware(ctx) {\n\t\t\t// Call handler without waiting\n\t\t\t\tif (currentInFlight < opts.concurrency) {\n\t\t\t\t\tcurrentInFlight++;\n\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\t\t\t\t\treturn handler(ctx)\n\t\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\t\t\t\t\t\t\tcallNext();\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, currentInFlight, { action: action.name, service: service.fullName });\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\t\t\t\t\t\t\tcallNext();\n\t\t\t\t\t\t\treturn broker.Promise.reject(err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Check whether the queue is full\n\t\t\t\tif (opts.maxQueueSize && queue.length >= opts.maxQueueSize) {\n\t\t\t\t\treturn broker.Promise.reject(new QueueIsFullError({ action: ctx.action.name, nodeID: ctx.nodeID }));\n\t\t\t\t}\n\n\t\t\t\t// Store the request in the queue\n\t\t\t\tconst p = new Promise((resolve, reject) => queue.push({ resolve, reject, ctx }));\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, queue.length, { action: action.name, service: service.fullName });\n\n\t\t\t\treturn p;\n\n\t\t\t}.bind(this);\n\t\t}\n\n\t\treturn handler;\n\t}\n\n\tfunction wrapEventBulkheadMiddleware(handler, event) {\n\t\tconst service = event.service;\n\n\t\tconst opts = Object.assign({}, this.options.bulkhead || {}, event.bulkhead || {});\n\t\tif (opts.enabled) {\n\t\t\tconst queue = [];\n\t\t\tlet currentInFlight = 0;\n\n\t\t\t// Call the next request from the queue\n\t\t\tconst callNext = function callNext() {\n\t\t\t/* istanbul ignore next */\n\t\t\t\tif (queue.length == 0) return;\n\n\t\t\t\t/* istanbul ignore next */\n\t\t\t\tif (currentInFlight >= opts.concurrency) return;\n\n\t\t\t\tconst item = queue.shift();\n\n\t\t\t\tcurrentInFlight++;\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\n\t\t\t\thandler(item.ctx)\n\t\t\t\t\t.then(res => {\n\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\t\t\t\t\t\titem.resolve(res);\n\t\t\t\t\t\tcallNext();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\t\t\t\t\t\titem.reject(err);\n\t\t\t\t\t\tcallNext();\n\t\t\t\t\t});\n\t\t\t};\n\n\t\t\treturn function bulkheadMiddleware(ctx) {\n\t\t\t\t// Call handler without waiting\n\t\t\t\tif (currentInFlight < opts.concurrency) {\n\t\t\t\t\tcurrentInFlight++;\n\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\t\t\t\t\treturn handler(ctx)\n\t\t\t\t\t\t.then(res => {\n\t\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\t\t\t\t\t\t\tcallNext();\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\t\tcurrentInFlight--;\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, currentInFlight, { event: event.name, service: service.fullName });\n\t\t\t\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\t\t\t\t\t\t\tcallNext();\n\t\t\t\t\t\t\treturn broker.Promise.reject(err);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Check whether the queue is full\n\t\t\t\tif (opts.maxQueueSize && queue.length >= opts.maxQueueSize) {\n\t\t\t\t\treturn broker.Promise.reject(new QueueIsFullError({ event: ctx.eventName, service: service.fullName, nodeID: ctx.nodeID }));\n\t\t\t\t}\n\n\t\t\t\t// Store the request in the queue\n\t\t\t\tconst p = new Promise((resolve, reject) => queue.push({ resolve, reject, ctx }));\n\t\t\t\tbroker.metrics.set(METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, queue.length, { event: event.name, service: service.fullName });\n\n\t\t\t\treturn p;\n\n\t\t\t}.bind(this);\n\t\t}\n\n\t\treturn handler;\n\t}\n\n\n\treturn {\n\t\tname: \"Bulkhead\",\n\n\t\tcreated() {\n\t\t\tif (broker.isMetricsEnabled()) {\n\t\t\t\tbroker.metrics.register({ name: METRIC.MOLECULER_REQUEST_BULKHEAD_INFLIGHT, type: METRIC.TYPE_GAUGE, labelNames: [\"action\", \"service\"] });\n\t\t\t\tbroker.metrics.register({ name: METRIC.MOLECULER_REQUEST_BULKHEAD_QUEUE_SIZE, type: METRIC.TYPE_GAUGE, labelNames: [\"action\", \"service\"] });\n\n\t\t\t\tbroker.metrics.register({ name: METRIC.MOLECULER_EVENT_BULKHEAD_INFLIGHT, type: METRIC.TYPE_GAUGE, labelNames: [\"event\", \"service\"] });\n\t\t\t\tbroker.metrics.register({ name: METRIC.MOLECULER_EVENT_BULKHEAD_QUEUE_SIZE, type: METRIC.TYPE_GAUGE, labelNames: [\"event\", \"service\"] });\n\t\t\t}\n\t\t},\n\n\t\tlocalAction: wrapActionBulkheadMiddleware,\n\t\tlocalEvent: wrapEventBulkheadMiddleware\n\t};\n};\n"],"names":["require$$0","require$$1"],"mappings":"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"}
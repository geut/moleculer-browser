{"version":3,"file":"tracing.js","sources":["../../../../../src/moleculer/src/middlewares/tracing.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst _ = require(\"lodash\");\nconst { isFunction, isPlainObject } = require(\"../utils\");\n\nmodule.exports = function TracingMiddleware(broker) {\n\n\tconst tracer = broker.tracer;\n\n\tfunction tracingLocalActionMiddleware(handler, action) {\n\t\tlet opts = action.tracing;\n\t\tif (opts === true || opts === false)\n\t\t\topts = { enabled: !!opts };\n\t\topts = _.defaultsDeep({}, opts, { enabled: true });\n\n\t\tif (opts.enabled) {\n\t\t\treturn function tracingLocalActionMiddleware(ctx) {\n\n\t\t\t\tctx.requestID = ctx.requestID || tracer.getCurrentTraceID();\n\t\t\t\tctx.parentID = ctx.parentID || tracer.getActiveSpanID();\n\n\t\t\t\tconst tags = {\n\t\t\t\t\tcallingLevel: ctx.level,\n\t\t\t\t\taction: ctx.action ? {\n\t\t\t\t\t\tname: ctx.action.name,\n\t\t\t\t\t\trawName: ctx.action.rawName\n\t\t\t\t\t} : null,\n\t\t\t\t\tremoteCall: ctx.nodeID !== ctx.broker.nodeID,\n\t\t\t\t\tcallerNodeID: ctx.nodeID,\n\t\t\t\t\tnodeID: ctx.broker.nodeID,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\ttimeout: ctx.options.timeout,\n\t\t\t\t\t\tretries: ctx.options.retries\n\t\t\t\t\t},\n\t\t\t\t\trequestID: ctx.requestID,\n\t\t\t\t};\n\t\t\t\tconst globalActionTags = tracer.opts.tags.action;\n\t\t\t\tlet actionTags;\n\t\t\t\t// local action tags take precedence\n\t\t\t\tif (isFunction(opts.tags)) {\n\t\t\t\t\tactionTags = opts.tags;\n\t\t\t\t} else if (!opts.tags && isFunction(globalActionTags)) {\n\t\t\t\t\tactionTags = globalActionTags;\n\t\t\t\t} else {\n\t\t\t\t\t// By default all params are captured. This can be overridden globally and locally\n\t\t\t\t\tactionTags = { ...{ params: true }, ...globalActionTags, ...opts.tags };\n\t\t\t\t}\n\n\t\t\t\tif (isFunction(actionTags)) {\n\t\t\t\t\tconst res = actionTags.call(ctx.service, ctx);\n\t\t\t\t\tif (res)\n\t\t\t\t\t\tObject.assign(tags, res);\n\n\t\t\t\t} else if (isPlainObject(actionTags)) {\n\t\t\t\t\tif (actionTags.params === true)\n\t\t\t\t\t\ttags.params = ctx.params != null && isPlainObject(ctx.params) ? Object.assign({}, ctx.params) : ctx.params;\n\t\t\t\t\telse if (Array.isArray(actionTags.params))\n\t\t\t\t\t\ttags.params = _.pick(ctx.params, actionTags.params);\n\n\t\t\t\t\tif (actionTags.meta === true)\n\t\t\t\t\t\ttags.meta = ctx.meta != null ? Object.assign({}, ctx.meta) : ctx.meta;\n\t\t\t\t\telse if (Array.isArray(actionTags.meta))\n\t\t\t\t\t\ttags.meta = _.pick(ctx.meta, actionTags.meta);\n\t\t\t\t}\n\n\t\t\t\tlet spanName = `action '${ctx.action.name}'`;\n\t\t\t\tif (opts.spanName) {\n\t\t\t\t\tswitch(typeof opts.spanName) {\n\t\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\t\tspanName = opts.spanName;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"function\":\n\t\t\t\t\t\t\tspanName = opts.spanName.call(ctx.service, ctx);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst span = ctx.startSpan(spanName, {\n\t\t\t\t\tid: ctx.id,\n\t\t\t\t\ttype: \"action\",\n\t\t\t\t\ttraceID: ctx.requestID,\n\t\t\t\t\tparentID: ctx.parentID,\n\t\t\t\t\tservice: ctx.service,\n\t\t\t\t\tsampled: ctx.tracing,\n\t\t\t\t\ttags\n\t\t\t\t});\n\n\t\t\t\tctx.tracing = span.sampled;\n\n\t\t\t\t// Call the handler\n\t\t\t\treturn handler(ctx).then(res => {\n\t\t\t\t\tconst tags = {\n\t\t\t\t\t\tfromCache: ctx.cachedResult\n\t\t\t\t\t};\n\n\t\t\t\t\tif (isFunction(actionTags)) {\n\t\t\t\t\t\tconst r = actionTags.call(ctx.service, ctx, res);\n\t\t\t\t\t\tif (r)\n\t\t\t\t\t\t\tObject.assign(tags, r);\n\n\t\t\t\t\t} else if (isPlainObject(actionTags)) {\n\t\t\t\t\t\tif (actionTags.response === true)\n\t\t\t\t\t\t\ttags.response = res != null && isPlainObject(res) ? Object.assign({}, res) : res;\n\t\t\t\t\t\telse if (Array.isArray(actionTags.response))\n\t\t\t\t\t\t\ttags.response = _.pick(res, actionTags.response);\n\t\t\t\t\t}\n\n\t\t\t\t\tspan.addTags(tags);\n\t\t\t\t\tctx.finishSpan(span);\n\n\t\t\t\t\t//ctx.duration = span.duration;\n\n\t\t\t\t\treturn res;\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tspan.setError(err);\n\t\t\t\t\tctx.finishSpan(span);\n\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\n\t\t\t}.bind(this);\n\t\t}\n\n\t\treturn handler;\n\t}\n\n\tfunction tracingLocalEventMiddleware(handler, event) {\n\t\tconst service = event.service;\n\n\t\tlet opts = event.tracing;\n\t\tif (opts === true || opts === false)\n\t\t\topts = { enabled: !!opts };\n\t\topts = _.defaultsDeep({}, opts, { enabled: true  });\n\n\t\tif (opts.enabled) {\n\t\t\treturn function tracingLocalEventMiddleware(ctx) {\n\n\t\t\t\tctx.requestID = ctx.requestID || tracer.getCurrentTraceID();\n\t\t\t\tctx.parentID = ctx.parentID || tracer.getActiveSpanID();\n\n\t\t\t\tconst tags = {\n\t\t\t\t\tevent: {\n\t\t\t\t\t\tname: event.name,\n\t\t\t\t\t\tgroup: event.group\n\t\t\t\t\t},\n\t\t\t\t\teventName: ctx.eventName,\n\t\t\t\t\teventType: ctx.eventType,\n\t\t\t\t\tcallerNodeID: ctx.nodeID,\n\t\t\t\t\tcallingLevel: ctx.level,\n\t\t\t\t\tremoteCall: ctx.nodeID !== broker.nodeID,\n\t\t\t\t\tnodeID: broker.nodeID,\n\t\t\t\t\trequestID: ctx.requestID,\n\t\t\t\t};\n\n\t\t\t\tconst globalEventTags = tracer.opts.tags.event;\n\t\t\t\tlet eventTags;\n\t\t\t\t// local event tags take precedence\n\t\t\t\tif (isFunction(opts.tags)) {\n\t\t\t\t\teventTags = opts.tags;\n\t\t\t\t} else if (!opts.tags && isFunction(globalEventTags)) {\n\t\t\t\t\teventTags = globalEventTags;\n\t\t\t\t} else {\n\t\t\t\t\t// By default all params are captured. This can be overridden globally and locally\n\t\t\t\t\teventTags = { ...{ params: true }, ...globalEventTags, ...opts.tags };\n\t\t\t\t}\n\n\t\t\t\tif (isFunction(eventTags)) {\n\t\t\t\t\tconst res = eventTags.call(service, ctx);\n\t\t\t\t\tif (res)\n\t\t\t\t\t\tObject.assign(tags, res);\n\n\t\t\t\t} else if (isPlainObject(eventTags)) {\n\t\t\t\t\tif (eventTags.params === true)\n\t\t\t\t\t\ttags.params = ctx.params != null && isPlainObject(ctx.params) ? Object.assign({}, ctx.params) : ctx.params;\n\t\t\t\t\telse if (Array.isArray(eventTags.params))\n\t\t\t\t\t\ttags.params = _.pick(ctx.params, eventTags.params);\n\n\t\t\t\t\tif (eventTags.meta === true)\n\t\t\t\t\t\ttags.meta = ctx.meta != null ? Object.assign({}, ctx.meta) : ctx.meta;\n\t\t\t\t\telse if (Array.isArray(eventTags.meta))\n\t\t\t\t\t\ttags.meta = _.pick(ctx.meta, eventTags.meta);\n\t\t\t\t}\n\n\t\t\t\tlet spanName = `event '${ctx.eventName}' in '${service.fullName}'`;\n\t\t\t\tif (opts.spanName) {\n\t\t\t\t\tswitch(typeof opts.spanName) {\n\t\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\t\tspanName = opts.spanName;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"function\":\n\t\t\t\t\t\t\tspanName = opts.spanName.call(service, ctx);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst span = ctx.startSpan(spanName, {\n\t\t\t\t\tid: ctx.id,\n\t\t\t\t\ttype: \"event\",\n\t\t\t\t\ttraceID: ctx.requestID,\n\t\t\t\t\tparentID: ctx.parentID,\n\t\t\t\t\tservice,\n\t\t\t\t\tsampled: ctx.tracing,\n\t\t\t\t\ttags\n\t\t\t\t});\n\n\t\t\t\tctx.tracing = span.sampled;\n\n\t\t\t\t// Call the handler\n\t\t\t\treturn handler.apply(service, arguments).then(() => {\n\t\t\t\t\tctx.finishSpan(span);\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tspan.setError(err);\n\t\t\t\t\tctx.finishSpan(span);\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\n\t\t\t}.bind(this);\n\t\t}\n\n\t\treturn handler;\n\t}\n\n\t/*\n\tfunction wrapRemoteTracingMiddleware(handler) {\n\n\t\tif (this.options.tracing) {\n\t\t\treturn function tracingMiddleware(ctx) {\n\t\t\t\tif (ctx.tracing == null) {\n\t\t\t\t\tctx.tracing = shouldTracing(ctx);\n\t\t\t\t}\n\t\t\t\treturn handler(ctx);\n\n\t\t\t}.bind(this);\n\t\t}\n\n\t\treturn handler;\n\t}*/\n\treturn {\n\t\tname: \"Tracing\",\n\n\t\tlocalAction: broker.isTracingEnabled() && tracer.opts.actions ? tracingLocalActionMiddleware : null,\n\t\tlocalEvent: broker.isTracingEnabled() && tracer.opts.events ? tracingLocalEventMiddleware : null,\n\t\t//remoteAction: wrapRemoteTracingMiddleware\n\t};\n};\n"],"names":["require$$0"],"mappings":"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"}
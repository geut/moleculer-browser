import e from"lodash";import r from"../utils.js";const{isFunction:o,isString:c}=r;export default function(r){function s(e,c,s,n){return o(e)?e.call(c,s,n):Array.isArray(e)?e.reduce(((e,r)=>e.then((e=>r.call(c,s,e)))),r.Promise.resolve(n)):void 0}function n(e,c,s,n){return o(e)?e.call(c,s,n):Array.isArray(e)?e.reduce(((e,r)=>e.catch((e=>r.call(c,s,e)))),r.Promise.reject(n)):void 0}function i(r,s){return c(r)?s&&o(s[r])?s[r]:null:Array.isArray(r)?e.compact(r.map((e=>c(e)?s&&o(s[e])?s[e]:null:e))):r}return{name:"ActionHook",localAction:function(e,o){const c=o.rawName||o.name,t=o.service&&o.service.schema?o.service.schema.hooks:null;if(t||o.hooks){const l=t&&t.before?i(t.before["*"],o.service):null,a=t&&t.after?i(t.after["*"],o.service):null,u=t&&t.error?i(t.error["*"],o.service):null,h=t&&t.before?i(t.before[c],o.service):null,v=t&&t.after?i(t.after[c],o.service):null,f=t&&t.error?i(t.error[c],o.service):null,m=o.hooks&&o.hooks.before?i(o.hooks.before,o.service):null,k=o.hooks&&o.hooks.after?i(o.hooks.after,o.service):null,A=o.hooks&&o.hooks.error?i(o.hooks.error,o.service):null;if(l||h||m||a||v||k||u||f||A)return function(o){let c=r.Promise.resolve();return l&&(c=c.then((()=>s(l,o.service,o)))),h&&(c=c.then((()=>s(h,o.service,o)))),m&&(c=c.then((()=>s(m,o.service,o)))),c=c.then((()=>e(o))),k&&(c=c.then((e=>s(k,o.service,o,e)))),v&&(c=c.then((e=>s(v,o.service,o,e)))),a&&(c=c.then((e=>s(a,o.service,o,e)))),A&&(c=c.catch((e=>n(A,o.service,o,e)))),f&&(c=c.catch((e=>n(f,o.service,o,e)))),u&&(c=c.catch((e=>n(u,o.service,o,e)))),c}}return e}}}
//# sourceMappingURL=action-hook.js.map

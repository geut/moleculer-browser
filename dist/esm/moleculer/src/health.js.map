{"version":3,"file":"health.js","sources":["../../../../src/moleculer/src/health.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst os = require(\"os\");\nconst { getIpList } = require(\"./utils\");\nconst MOLECULER_VERSION = require(\"../package.json\").version;\n\nconst getClientInfo = () => {\n\treturn {\n\t\ttype: \"nodejs\",\n\t\tversion: MOLECULER_VERSION,\n\t\tlangVersion: process.version\n\t};\n};\n\nconst getCpuInfo = () => {\n\tconst cpus = os.cpus();\n\tconst load = os.loadavg();\n\tconst cpu = {\n\t\tload1: load[0],\n\t\tload5: load[1],\n\t\tload15: load[2],\n\t\tcores: Array.isArray(cpus) ? os.cpus().length : null,\n\t};\n\tcpu.utilization = Math.min(Math.floor(load[0] * 100 / cpu.cores), 100);\n\n\treturn cpu;\n};\n\nconst getMemoryInfo = () => {\n\tconst mem = {\n\t\tfree: os.freemem(),\n\t\ttotal: os.totalmem()\n\t};\n\tmem.percent = (mem.free * 100 / mem.total);\n\n\treturn mem;\n};\n\nconst getUserInfo = () => {\n\ttry {\n\t\treturn os.userInfo();\n\t} catch (e) {\n\t\treturn {};\n\t}\n};\n\nconst getOsInfo = () => {\n\treturn {\n\t\tuptime: os.uptime(),\n\t\ttype: os.type(),\n\t\trelease: os.release(),\n\t\thostname: os.hostname(),\n\t\tarch: os.arch(),\n\t\tplatform: os.platform(),\n\t\tuser: getUserInfo()\n\t};\n};\n\nconst getProcessInfo = () => {\n\treturn {\n\t\tpid: process.pid,\n\t\tmemory: process.memoryUsage(),\n\t\tuptime: process.uptime(),\n\t\targv: process.argv\n\t};\n};\n\nconst getNetworkInterfacesInfo = () => {\n\treturn {\n\t\tip:  getIpList()\n\t};\n};\n\nconst getDateTimeInfo = () => {\n\treturn {\n\t\tnow: Date.now(),\n\t\tiso: new Date().toISOString(),\n\t\tutc: new Date().toUTCString()\n\t};\n};\n\nconst getHealthStatus = (/*broker*/) => {\n\treturn {\n\t\tcpu: getCpuInfo(),\n\t\tmem: getMemoryInfo(),\n\t\tos: getOsInfo(),\n\t\tprocess: getProcessInfo(),\n\t\tclient: getClientInfo(),\n\t\tnet: getNetworkInterfacesInfo(),\n\t\ttime: getDateTimeInfo()\n\t};\n};\n\nmodule.exports = {\n\tgetHealthStatus,\n\tgetCpuInfo,\n\tgetMemoryInfo,\n\tgetOsInfo,\n\tgetProcessInfo,\n\tgetClientInfo,\n\tgetNetworkInterfacesInfo,\n\tgetDateTimeInfo\n};\n"],"names":["require$$0","require$$1","process"],"mappings":"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"}
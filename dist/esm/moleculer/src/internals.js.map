{"version":3,"file":"internals.js","sources":["../../../../src/moleculer/src/internals.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2020 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { MoleculerClientError } = require(\"./errors\");\nconst utils = require(\"./utils\");\n\nmodule.exports = function() {\n\tconst schema = {\n\t\tname: \"$node\",\n\n\t\tactions: {\n\t\t\tlist: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\twithServices: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getNodeList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tservices: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithActions: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEvents: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tgrouping: { type: \"boolean\", optional: true, convert: true, default: true },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getServiceList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tactions: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEndpoints: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getActionList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tevents: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEndpoints: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getEventList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thealth: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\thandler() {\n\t\t\t\t\treturn this.broker.getHealthStatus();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\toptions: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {},\n\t\t\t\thandler() {\n\t\t\t\t\treturn utils.safetyObject(this.broker.options, this.broker.options);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmetrics: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\ttypes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] },\n\t\t\t\t\tincludes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] },\n\t\t\t\t\texcludes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] }\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\tif (!this.broker.isMetricsEnabled())\n\t\t\t\t\t\treturn this.Promise.reject(new MoleculerClientError(\"Metrics feature is disabled\", 400, \"METRICS_DISABLED\"));\n\n\t\t\t\t\treturn this.broker.metrics.list(ctx.params);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\treturn schema;\n};\n"],"names":["MoleculerClientError","require$$0","name","actions","list","cache","tracing","params","withServices","type","optional","convert","default","onlyAvailable","[object Object]","ctx","this","broker","registry","getNodeList","services","onlyLocal","skipInternal","withActions","withEvents","grouping","getServiceList","withEndpoints","getActionList","events","getEventList","health","getHealthStatus","options","utils","safetyObject","metrics","types","rules","items","includes","excludes","isMetricsEnabled","Promise","reject"],"mappings":"qDAQA,MAAMA,qBAAEA,GAAyBC,iBAGhB,WAgGhB,MA/Fe,CACdC,KAAM,QAENC,QAAS,CACRC,KAAM,CACLC,OAAO,EACPC,SAAS,EACTC,OAAQ,CACPC,aAAc,CAAEC,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACzEC,cAAe,CAAEJ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,IAE3EE,QAAQC,GACP,OAAOC,KAAKC,OAAOC,SAASC,YAAYJ,EAAIR,UAI9Ca,SAAU,CACTf,OAAO,EACPC,SAAS,EACTC,OAAQ,CACPc,UAAW,CAAEZ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACtEU,aAAc,CAAEb,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACzEW,YAAa,CAAEd,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACxEY,WAAY,CAAEf,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACvEC,cAAe,CAAEJ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GAC1Ea,SAAU,CAAEhB,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,IAEtEE,QAAQC,GACP,OAAOC,KAAKC,OAAOC,SAASQ,eAAeX,EAAIR,UAIjDJ,QAAS,CACRE,OAAO,EACPC,SAAS,EACTC,OAAQ,CACPc,UAAW,CAAEZ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACtEU,aAAc,CAAEb,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACzEe,cAAe,CAAElB,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GAC1EC,cAAe,CAAEJ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,IAE3EE,QAAQC,GACP,OAAOC,KAAKC,OAAOC,SAASU,cAAcb,EAAIR,UAIhDsB,OAAQ,CACPxB,OAAO,EACPC,SAAS,EACTC,OAAQ,CACPc,UAAW,CAAEZ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACtEU,aAAc,CAAEb,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GACzEe,cAAe,CAAElB,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,GAC1EC,cAAe,CAAEJ,KAAM,UAAWC,UAAU,EAAMC,SAAS,EAAMC,SAAS,IAE3EE,QAAQC,GACP,OAAOC,KAAKC,OAAOC,SAASY,aAAaf,EAAIR,UAI/CwB,OAAQ,CACP1B,OAAO,EACPC,SAAS,EACTQ,UACC,OAAOE,KAAKC,OAAOe,oBAIrBC,QAAS,CACR5B,OAAO,EACPC,SAAS,EACTC,OAAQ,GACRO,UACC,OAAOoB,EAAMC,aAAanB,KAAKC,OAAOgB,QAASjB,KAAKC,OAAOgB,WAI7DG,QAAS,CACR/B,OAAO,EACPC,SAAS,EACTC,OAAQ,CACP8B,MAAO,CAAE5B,KAAM,QAASC,UAAU,EAAM4B,MAAO,CAAE,CAAE7B,KAAM,UAAY,CAAEA,KAAM,QAAS8B,MAAO,YAC7FC,SAAU,CAAE/B,KAAM,QAASC,UAAU,EAAM4B,MAAO,CAAE,CAAE7B,KAAM,UAAY,CAAEA,KAAM,QAAS8B,MAAO,YAChGE,SAAU,CAAEhC,KAAM,QAASC,UAAU,EAAM4B,MAAO,CAAE,CAAE7B,KAAM,UAAY,CAAEA,KAAM,QAAS8B,MAAO,aAEjGzB,QAAQC,GACP,OAAKC,KAAKC,OAAOyB,mBAGV1B,KAAKC,OAAOmB,QAAQhC,KAAKW,EAAIR,QAF5BS,KAAK2B,QAAQC,OAAO,IAAI5C,EAAqB,8BAA+B,IAAK"}
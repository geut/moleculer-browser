{"version":3,"file":"internals.js","sources":["../../../../src/moleculer/src/internals.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2020 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { MoleculerClientError } = require(\"./errors\");\nconst utils = require(\"./utils\");\n\nmodule.exports = function() {\n\tconst schema = {\n\t\tname: \"$node\",\n\n\t\tactions: {\n\t\t\tlist: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\twithServices: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getNodeList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tservices: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithActions: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEvents: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tgrouping: { type: \"boolean\", optional: true, convert: true, default: true },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getServiceList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tactions: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEndpoints: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getActionList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tevents: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\tonlyLocal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tskipInternal: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\twithEndpoints: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t\tonlyAvailable: { type: \"boolean\", optional: true, convert: true, default: false },\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\treturn this.broker.registry.getEventList(ctx.params);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thealth: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\thandler() {\n\t\t\t\t\treturn this.broker.getHealthStatus();\n\t\t\t\t}\n\t\t\t},\n\n\t\t\toptions: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {},\n\t\t\t\thandler() {\n\t\t\t\t\treturn utils.safetyObject(this.broker.options, this.broker.options);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tmetrics: {\n\t\t\t\tcache: false,\n\t\t\t\ttracing: false,\n\t\t\t\tparams: {\n\t\t\t\t\ttypes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] },\n\t\t\t\t\tincludes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] },\n\t\t\t\t\texcludes: { type: \"multi\", optional: true, rules: [ { type: \"string\" }, { type: \"array\", items: \"string\" } ] }\n\t\t\t\t},\n\t\t\t\thandler(ctx) {\n\t\t\t\t\tif (!this.broker.isMetricsEnabled())\n\t\t\t\t\t\treturn this.Promise.reject(new MoleculerClientError(\"Metrics feature is disabled\", 400, \"METRICS_DISABLED\"));\n\n\t\t\t\t\treturn this.broker.metrics.list(ctx.params);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\treturn schema;\n};\n"],"names":["require$$0","utils"],"mappings":"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"}
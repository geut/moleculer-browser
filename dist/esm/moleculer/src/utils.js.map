{"version":3,"file":"utils.js","sources":["../../../../src/moleculer/src/utils.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst kleur\t\t= require(\"kleur\");\nconst os \t \t= require(\"os\");\nconst path \t \t= require(\"path\");\nconst fs \t \t= require(\"fs\");\nconst ExtendableError = require(\"es6-error\");\n\nconst lut = [];\nfor (let i=0; i<256; i++) { lut[i] = (i<16?\"0\":\"\")+(i).toString(16); }\n\nconst RegexCache = new Map();\n\nconst deprecateList = [];\n\nconst byteMultipliers = {\n\tb:  1,\n\tkb: 1 << 10,\n\tmb: 1 << 20,\n\tgb: 1 << 30,\n\ttb: Math.pow(1024, 4),\n\tpb: Math.pow(1024, 5),\n};\n// eslint-disable-next-line security/detect-unsafe-regex\nconst parseByteStringRe = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i;\n\nclass TimeoutError extends ExtendableError {}\n\n/**\n * Circular replacing of unsafe properties in object\n *\n * @param {Object=} options List of options to change circularReplacer behaviour\n * @param {number=} options.maxSafeObjectSize Maximum size of objects for safe object converting\n * @return {function(...[*]=)}\n */\nfunction circularReplacer(options = { maxSafeObjectSize: Infinity }) {\n\tconst seen = new WeakSet();\n\treturn function(key, value) {\n\t\tif (typeof value === \"object\" && value !== null) {\n\t\t\tconst objectType = value.constructor && value.constructor.name || typeof value;\n\n\t\t\tif (options.maxSafeObjectSize && \"length\" in value && value.length > options.maxSafeObjectSize) {\n\t\t\t\treturn `[${objectType} ${value.length}]`;\n\t\t\t}\n\n\t\t\tif (options.maxSafeObjectSize && \"size\" in value && value.size > options.maxSafeObjectSize) {\n\t\t\t\treturn `[${objectType} ${value.size}]`;\n\t\t\t}\n\n\t\t\tif (seen.has(value)) {\n\t\t\t\t//delete this[key];\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tseen.add(value);\n\t\t}\n\t\treturn value;\n\t};\n}\n\nconst units = [\"h\", \"m\", \"s\", \"ms\", \"μs\", \"ns\"];\nconst divisors = [60 * 60 * 1000, 60 * 1000, 1000, 1, 1e-3, 1e-6];\n\nconst utils = {\n\n\tisFunction(fn) {\n\t\treturn typeof fn === \"function\";\n\t},\n\n\tisString(s) {\n\t\treturn typeof s === \"string\" || s instanceof String;\n\t},\n\n\tisObject(o) {\n\t\treturn o !== null && typeof o === \"object\" && !(o instanceof String);\n\t},\n\n\tisPlainObject(o) {\n\t\treturn o !=null ? Object.getPrototypeOf(o) === Object.prototype || Object.getPrototypeOf(o) === null : false;\n\t},\n\n\tflatten(arr) {\n\t\treturn Array.prototype.reduce.call(arr, (a, b) => a.concat(b), []);\n\t},\n\n\thumanize(milli) {\n\t\tif (milli == null) return \"?\";\n\n\t\tfor (let i = 0; i < divisors.length; i++) {\n\t\t\tconst val = milli / divisors[i];\n\t\t\tif (val >= 1.0)\n\t\t\t\treturn \"\" + Math.floor(val) + units[i];\n\t\t}\n\n\t\treturn \"now\";\n\t},\n\n\t// Fast UUID generator: e7 https://jsperf.com/uuid-generator-opt/18\n\tgenerateToken() {\n\t\tconst d0 = Math.random()*0xffffffff|0;\n\t\tconst d1 = Math.random()*0xffffffff|0;\n\t\tconst d2 = Math.random()*0xffffffff|0;\n\t\tconst d3 = Math.random()*0xffffffff|0;\n\t\treturn lut[d0&0xff]+lut[d0>>8&0xff]+lut[d0>>16&0xff]+lut[d0>>24&0xff]+\"-\"+\n\t\t\tlut[d1&0xff]+lut[d1>>8&0xff]+\"-\"+lut[d1>>16&0x0f|0x40]+lut[d1>>24&0xff]+\"-\"+\n\t\t\tlut[d2&0x3f|0x80]+lut[d2>>8&0xff]+\"-\"+lut[d2>>16&0xff]+lut[d2>>24&0xff]+\n\t\t\tlut[d3&0xff]+lut[d3>>8&0xff]+lut[d3>>16&0xff]+lut[d3>>24&0xff];\n\t},\n\n\tremoveFromArray(arr, item) {\n\t\tif (!arr || arr.length == 0) return arr;\n\t\tconst idx = arr.indexOf(item);\n\t\tif (idx !== -1)\n\t\t\tarr.splice(idx, 1);\n\n\t\treturn arr;\n\t},\n\n\t/**\n\t * Get default NodeID (computerName)\n\t *\n\t * @returns\n\t */\n\tgetNodeID() {\n\t\treturn os.hostname().toLowerCase() + \"-\" + process.pid;\n\t},\n\n\t/**\n\t * Get list of local IPs\n\t *\n\t * @returns\n\t */\n\tgetIpList() {\n\t\tconst list = [];\n\t\tconst ilist = [];\n\t\tconst interfaces = os.networkInterfaces();\n\t\tfor (let iface in interfaces) {\n\t\t\tfor (let i in interfaces[iface]) {\n\t\t\t\tconst f = interfaces[iface][i];\n\t\t\t\tif (f.family === \"IPv4\") {\n\t\t\t\t\tif (f.internal) {\n\t\t\t\t\t\tilist.push(f.address);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlist.push(f.address);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn list.length > 0 ? list : ilist;\n\t},\n\n\t/**\n\t * Check the param is a Promise instance\n\t *\n\t * @param {any} p\n\t * @returns\n\t */\n\tisPromise(p) {\n\t\treturn (p != null && typeof p.then === \"function\");\n\t},\n\n\t/**\n\t * Polyfill a Promise library with missing Bluebird features.\n\t *\n\t * NOT USED & NOT TESTED YET !!!\n\t *\n\t * @param {PromiseClass} P\n\t */\n\tpolyfillPromise(P) {\n\t\tif (!utils.isFunction(P.method)) {\n\t\t\t// Based on https://github.com/petkaantonov/bluebird/blob/master/src/method.js#L8\n\t\t\tP.method = function(fn) {\n\t\t\t\treturn function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst val = fn.apply(this, arguments);\n\t\t\t\t\t\treturn P.resolve(val);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treturn P.reject(err);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\n\t\tif (!utils.isFunction(P.delay)) {\n\t\t\t// Based on https://github.com/petkaantonov/bluebird/blob/master/src/timers.js#L15\n\t\t\tP.delay = function(ms) {\n\t\t\t\treturn new P(resolve => setTimeout(resolve, +ms));\n\t\t\t};\n\t\t\tP.prototype.delay = function(ms) {\n\t\t\t\treturn this.then(res => P.delay(ms).then(() => res));\n\t\t\t\t//return this.then(res => new P(resolve => setTimeout(() => resolve(res), +ms)));\n\t\t\t};\n\t\t}\n\n\t\tif (!utils.isFunction(P.prototype.timeout)) {\n\t\t\tP.TimeoutError = TimeoutError;\n\n\t\t\tP.prototype.timeout = function(ms, message) {\n\t\t\t\tlet timer;\n\t\t\t\tconst timeout = new P((resolve, reject) => {\n\t\t\t\t\ttimer = setTimeout(() => reject(new P.TimeoutError(message)), +ms);\n\t\t\t\t});\n\n\t\t\t\treturn P.race([\n\t\t\t\t\ttimeout,\n\t\t\t\t\tthis\n\t\t\t\t])\n\t\t\t\t\t.then(value => {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tif (!utils.isFunction(P.mapSeries)) {\n\n\t\t\tP.mapSeries = function(arr, fn) {\n\t\t\t\tconst promFn = Promise.method(fn);\n\t\t\t\tconst res = [];\n\n\t\t\t\treturn arr.reduce((p, item, i) => {\n\t\t\t\t\treturn p.then(r => {\n\t\t\t\t\t\tres[i] = r;\n\t\t\t\t\t\treturn promFn(item, i);\n\t\t\t\t\t});\n\t\t\t\t}, P.resolve()).then(r => {\n\t\t\t\t\tres[arr.length] = r;\n\t\t\t\t\treturn res.slice(1);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t},\n\n\t/**\n\t * Clear `require` cache. Used for service hot reloading\n\t *\n\t * @param {String} filename\n\t */\n\tclearRequireCache(filename) {\n\t\t/* istanbul ignore next */\n\t\tObject.keys(require.cache).forEach(function(key) {\n\t\t\tif (key == filename) {\n\t\t\t\tdelete require.cache[key];\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * String matcher to handle dot-separated event/action names.\n\t *\n\t * @param {String} text\n\t * @param {String} pattern\n\t * @returns {Boolean}\n\t */\n\tmatch(text, pattern) {\n\t\t// Simple patterns\n\t\tif (pattern.indexOf(\"?\") == -1) {\n\n\t\t\t// Exact match (eg. \"prefix.event\")\n\t\t\tconst firstStarPosition = pattern.indexOf(\"*\");\n\t\t\tif (firstStarPosition == -1) {\n\t\t\t\treturn pattern === text;\n\t\t\t}\n\n\t\t\t// Eg. \"prefix**\"\n\t\t\tconst len = pattern.length;\n\t\t\tif (len > 2 && pattern.endsWith(\"**\") && firstStarPosition > len - 3) {\n\t\t\t\tpattern = pattern.substring(0, len - 2);\n\t\t\t\treturn text.startsWith(pattern);\n\t\t\t}\n\n\t\t\t// Eg. \"prefix*\"\n\t\t\tif (len > 1 && pattern.endsWith(\"*\") && firstStarPosition > len - 2) {\n\t\t\t\tpattern = pattern.substring(0, len - 1);\n\t\t\t\tif (text.startsWith(pattern)) {\n\t\t\t\t\treturn text.indexOf(\".\", len) == -1;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Accept simple text, without point character (*)\n\t\t\tif (len == 1 && firstStarPosition == 0) {\n\t\t\t\treturn text.indexOf(\".\") == -1;\n\t\t\t}\n\n\t\t\t// Accept all inputs (**)\n\t\t\tif (len == 2 && firstStarPosition == 0 && pattern.lastIndexOf(\"*\") == 1) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Regex (eg. \"prefix.ab?cd.*.foo\")\n\t\tconst origPattern = pattern;\n\t\tlet regex = RegexCache.get(origPattern);\n\t\tif (regex == null) {\n\t\t\tif (pattern.startsWith(\"$\")) {\n\t\t\t\tpattern = \"\\\\\" + pattern;\n\t\t\t}\n\t\t\tpattern = pattern.replace(/\\?/g, \".\");\n\t\t\tpattern = pattern.replace(/\\*\\*/g, \"§§§\");\n\t\t\tpattern = pattern.replace(/\\*/g, \"[^\\\\.]*\");\n\t\t\tpattern = pattern.replace(/§§§/g, \".*\");\n\n\t\t\tpattern = \"^\" + pattern + \"$\";\n\n\t\t\t// eslint-disable-next-line security/detect-non-literal-regexp\n\t\t\tregex = new RegExp(pattern, \"\");\n\t\t\tRegexCache.set(origPattern, regex);\n\t\t}\n\t\treturn regex.test(text);\n\t},\n\n\t/**\n\t * Deprecate a method or property\n\t *\n\t * @param {Object|Function|String} prop\n\t * @param {String} msg\n\t */\n\tdeprecate(prop, msg) {\n\t\tif (arguments.length == 1)\n\t\t\tmsg = prop;\n\n\t\tif (deprecateList.indexOf(prop) === -1) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn(kleur.yellow().bold(`DeprecationWarning: ${msg}`));\n\t\t\tdeprecateList.push(prop);\n\t\t}\n\t},\n\n\t/**\n\t * Remove circular references & Functions from the JS object\n\t *\n\t * @param {Object|Array} obj\n\t * @param {Object=} options List of options to change circularReplacer behaviour\n\t * @param {number=} options.maxSafeObjectSize List of options to change circularReplacer behaviour\n\t * @returns {Object|Array}\n\t */\n\tsafetyObject(obj, options) {\n\t\treturn JSON.parse(JSON.stringify(obj, circularReplacer(options)));\n\t},\n\n\t/**\n\t * Sets a variable on an object based on its dot path.\n\t *\n\t * @param {Object} obj\n\t * @param {String} path\n\t * @param {*} value\n\t * @returns {Object}\n\t */\n\tdotSet(obj, path, value) {\n\t\tconst parts = path.split(\".\");\n\t\tconst part = parts.shift();\n\t\tif (parts.length > 0) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(obj, part)) {\n\t\t\t\tobj[part] = {};\n\t\t\t} else if (obj[part] == null) {\n\t\t\t\tobj[part] = {};\n\t\t\t} else {\n\t\t\t\tif (typeof obj[part] !== \"object\") {\n\t\t\t\t\tthrow new Error(\"Value already set and it's not an object\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tobj[part] = utils.dotSet(obj[part], parts.join(\".\"), value);\n\t\t\treturn obj;\n\t\t}\n\t\tobj[path] = value;\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Make directories recursively\n\t * @param {String} p - directory path\n\t */\n\tmakeDirs(p) {\n\t\tp.split(path.sep)\n\t\t\t.reduce((prevPath, folder) => {\n\t\t\t\tconst currentPath = path.join(prevPath, folder, path.sep);\n\t\t\t\tif (!fs.existsSync(currentPath)) {\n\t\t\t\t\tfs.mkdirSync(currentPath);\n\t\t\t\t}\n\t\t\t\treturn currentPath;\n\t\t\t}, \"\");\n\t},\n\n\t/**\n\t * Parse a byte string to number of bytes. E.g \"1kb\" -> 1024\n\t * Credits: https://github.com/visionmedia/bytes.js\n\t *\n\t * @param {String} v\n\t * @returns {Number}\n\t */\n\tparseByteString(v) {\n\t\tif (typeof v === \"number\" && !isNaN(v)) {\n\t\t\treturn v;\n\t\t}\n\n\t\tif (typeof v !== \"string\") {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Test if the string passed is valid\n\t\tlet results = parseByteStringRe.exec(v);\n\t\tlet floatValue;\n\t\tlet unit = \"b\";\n\n\t\tif (!results) {\n\t\t\t// Nothing could be extracted from the given string\n\t\t\tfloatValue = parseInt(v, 10);\n\t\t\tif (Number.isNaN(floatValue))\n\t\t\t\treturn null;\n\n\t\t\tunit = \"b\";\n\t\t} else {\n\t\t\t// Retrieve the value and the unit\n\t\t\tfloatValue = parseFloat(results[1]);\n\t\t\tunit = results[4].toLowerCase();\n\t\t}\n\n\t\treturn Math.floor(byteMultipliers[unit] * floatValue);\n\t}\n};\n\nmodule.exports = utils;\n"],"names":["lut","i","toString","RegexCache","Map","deprecateList","byteMultipliers","b","kb","mb","gb","tb","Math","pow","pb","parseByteStringRe","TimeoutError","ExtendableError","units","divisors","utils","isFunction","fn","isString","s","String","isObject","o","isPlainObject","Object","getPrototypeOf","prototype","flatten","arr","Array","reduce","call","a","concat","[object Object]","milli","length","val","floor","d0","random","d1","d2","d3","item","idx","indexOf","splice","getNodeID","os","hostname","toLowerCase","process","pid","list","ilist","interfaces","networkInterfaces","iface","f","family","internal","push","address","isPromise","p","then","P","method","apply","this","arguments","resolve","err","reject","delay","ms","setTimeout","res","timeout","message","timer","race","value","clearTimeout","catch","mapSeries","promFn","Promise","r","slice","filename","keys","require","cache","forEach","key","text","pattern","firstStarPosition","len","endsWith","substring","startsWith","lastIndexOf","origPattern","regex","get","replace","RegExp","set","test","prop","msg","console","warn","kleur","yellow","bold","safetyObject","obj","options","JSON","parse","stringify","maxSafeObjectSize","Infinity","seen","WeakSet","objectType","constructor","name","size","has","add","circularReplacer","path","parts","split","part","shift","hasOwnProperty","Error","dotSet","join","sep","prevPath","folder","currentPath","fs","existsSync","mkdirSync","v","isNaN","floatValue","results","exec","unit","parseFloat","parseInt","Number"],"mappings":"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"}
{"version":3,"file":"base.js","sources":["../../../../../src/moleculer/src/transporters/base.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst _\t= require(\"lodash\");\nconst P = require(\"../packets\");\nconst { flatten } = require(\"../utils\");\nconst { BrokerDisconnectedError } = require(\"../errors\");\n\n/**\n * Base Transporter class\n *\n * @class BaseTransporter\n */\nclass BaseTransporter {\n\n\t/**\n\t * Creates an instance of BaseTransporter.\n\t *\n\t * @param {any} opts\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tconstructor(opts) {\n\t\tthis.opts = opts;\n\t\tthis.connected = false;\n\t\tthis.hasBuiltInBalancer = false;\n\t}\n\n\t/**\n\t * Init transporter\n\t *\n\t * @param {Transit} transit\n\t * @param {Function} messageHandler\n\t * @param {Function} afterConnect\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tinit(transit, messageHandler, afterConnect) {\n\t\tif (transit) {\n\t\t\tthis.transit = transit;\n\t\t\tthis.broker = transit.broker;\n\t\t\tthis.nodeID = transit.nodeID;\n\t\t\tthis.logger = this.broker.getLogger(\"transporter\");\n\n\t\t\tthis.prefix = \"MOL\";\n\t\t\tif (this.broker.namespace)\n\t\t\t\tthis.prefix += \"-\" + this.broker.namespace;\n\n\t\t}\n\t\tthis.messageHandler = messageHandler;\n\t\tthis.afterConnect = afterConnect;\n\t}\n\n\t/**\n\t * Connect to the transporter server\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tconnect() {\n\t\t/* istanbul ignore next */\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Event handler for connected.\n\t *\n\t * @param {any} wasReconnect\n\t * @returns {Promise}\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tonConnected(wasReconnect) {\n\t\tthis.connected = true;\n\t\tif (this.afterConnect) {\n\t\t\treturn this.afterConnect(wasReconnect);\n\t\t}\n\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Disconnect from the transporter server\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tdisconnect() {\n\t\t/* istanbul ignore next */\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Subscribe to all topics\n\t *\n\t * @param {Array<Object>} topics\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tmakeSubscriptions(topics) {\n\t\treturn this.broker.Promise.all(topics.map(({ cmd, nodeID }) => this.subscribe(cmd, nodeID)));\n\t}\n\n\t/**\n\t * Process incoming messages\n\t *\n\t * @param {String} cmd\n\t * @param {Buffer} msg\n\t * @returns\n\t * @memberof BaseTransporter\n\t */\n\tincomingMessage(cmd, msg) {\n\t\tif (!msg) return;\n\t\ttry {\n\t\t\tconst packet = this.deserialize(cmd, msg);\n\t\t\treturn this.messageHandler(cmd, packet);\n\t\t} catch(err) {\n\t\t\tthis.logger.warn(\"Invalid incoming packet. Type:\", cmd, err);\n\t\t\tthis.logger.debug(\"Content:\", msg.toString ? msg.toString() : msg);\n\t\t}\n\t}\n\n\t/**\n\t * Received data. It's a wrapper for middlewares.\n\t * @param {String} cmd\n\t * @param {Buffer} data\n\t */\n\treceive(cmd, data) {\n\t\treturn this.incomingMessage(cmd, data);\n\t}\n\n\t/**\n\t * Subscribe to a command\n\t *\n\t * @param {String} cmd\n\t * @param {String} nodeID\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tsubscribe(/*cmd, nodeID*/) {\n\t\t/* istanbul ignore next */\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Subscribe to balanced action commands\n\t *\n\t * @param {String} action\n\t * @memberof AmqpTransporter\n\t */\n\tsubscribeBalancedRequest(/*action*/) {\n\t\t/* istanbul ignore next */\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Subscribe to balanced event command\n\t *\n\t * @param {String} event\n\t * @param {String} group\n\t * @memberof AmqpTransporter\n\t */\n\tsubscribeBalancedEvent(/*event, group*/) {\n\t\t/* istanbul ignore next */\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Unsubscribe all balanced request and event commands\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tunsubscribeFromBalancedCommands() {\n\t\t/* istanbul ignore next */\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Publish a normal not balanced packet\n\t *\n\t * @param {Packet} packet\n\t * @returns {Promise}\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tpublish(packet) {\n\t\tconst topic = this.getTopicName(packet.type, packet.target);\n\t\tconst data = this.serialize(packet);\n\n\t\treturn this.send(topic, data, { packet });\n\t}\n\n\t/**\n\t * Publish a balanced EVENT packet to a balanced queue\n\t *\n\t * @param {Packet} packet\n\t * @param {String} group\n\t * @returns {Promise}\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tpublishBalancedEvent(packet, group) {\n\t\tconst topic = `${this.prefix}.${P.PACKET_EVENT}B.${group}.${packet.payload.event}`;\n\t\tconst data = this.serialize(packet);\n\n\t\treturn this.send(topic, data, { packet, balanced: true });\n\t}\n\n\t/**\n\t * Publish a balanced REQ packet to a balanced queue\n\t *\n\t * @param {Packet} packet\n\t * @returns {Promise}\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tpublishBalancedRequest(packet) {\n\t\tconst topic = `${this.prefix}.${P.PACKET_REQUEST}B.${packet.payload.action}`;\n\t\tconst data = this.serialize(packet);\n\n\t\treturn this.send(topic, data, { packet, balanced: true });\n\t}\n\n\t/**\n\t * Send data buffer.\n\t *\n\t * @param {String} topic\n\t * @param {Buffer} data\n\t * @param {Object} meta\n\t *\n\t * @returns {Promise}\n\t */\n\tsend(/*topic, data, meta*/) {\n\t\tthrow new Error(\"Not implemented!\");\n\t}\n\n\t/**\n\t * Get topic name from command & target nodeID\n\t *\n\t * @param {any} cmd\n\t * @param {any} nodeID\n\t *\n\t * @memberof BaseTransporter\n\t */\n\tgetTopicName(cmd, nodeID) {\n\t\treturn this.prefix + \".\" + cmd + (nodeID ? \".\" + nodeID : \"\");\n\t}\n\n\t/**\n\t * Initialize queues for REQUEST & EVENT packets.\n\t *\n\t * @memberof AmqpTransporter\n\t */\n\tmakeBalancedSubscriptions() {\n\t\tif (!this.hasBuiltInBalancer) return this.broker.Promise.resolve();\n\n\t\treturn this.unsubscribeFromBalancedCommands().then(() => {\n\t\t\tconst services = this.broker.getLocalNodeInfo().services;\n\t\t\treturn this.broker.Promise.all(services.map(service => {\n\t\t\t\tconst p = [];\n\n\t\t\t\t// Service actions queues\n\t\t\t\tif (service.actions && typeof(service.actions) == \"object\") {\n\t\t\t\t\tp.push(Object.keys(service.actions).map(action => this.subscribeBalancedRequest(action)));\n\t\t\t\t}\n\n\t\t\t\t// Load-balanced/grouped events queues\n\t\t\t\tif (service.events && typeof(service.events) == \"object\") {\n\t\t\t\t\tp.push(Object.keys(service.events).map(event => {\n\t\t\t\t\t\tconst group = service.events[event].group || service.name;\n\t\t\t\t\t\tthis.subscribeBalancedEvent(event, group);\n\t\t\t\t\t}));\n\t\t\t\t}\n\n\t\t\t\treturn this.broker.Promise.all(_.compact(flatten(p, true)));\n\t\t\t}));\n\t\t});\n\t}\n\n\t/**\n\t * Prepublish a packet. Handle balancing.\n\t *\n\t * @param {Packet} packet\n\t * @returns {Promise}\n\t * @memberof BaseTransporter\n\t */\n\tprepublish(packet) {\n\t\t// Safely handle disconnected state\n\t\tif (!this.connected) {\n\t\t\t// For packets that are triggered intentionally by users, throw a retryable error.\n\t\t\tif ([P.PACKET_REQUEST, P.PACKET_EVENT, P.PACKET_PING].includes(packet.type)) {\n\t\t\t\treturn this.broker.Promise.reject(new BrokerDisconnectedError());\n\t\t\t}\n\n\t\t\t// For internal packets like INFO and HEARTBEATS, skip sending and don't throw\n\t\t\telse {\n\t\t\t\treturn this.broker.Promise.resolve();\n\t\t\t}\n\t\t}\n\n\t\tif (packet.type === P.PACKET_EVENT && packet.target == null && packet.payload.groups) {\n\t\t\tconst groups = packet.payload.groups;\n\t\t\t// If the packet contains groups, we don't send the packet to\n\t\t\t// the targetted node, but we push them to the event group queues\n\t\t\t// and AMQP will load-balanced it.\n\t\t\tif (groups.length > 0) {\n\t\t\t\tgroups.forEach(group => {\n\t\t\t\t\t// Change the groups to this group to avoid multi handling in consumers.\n\t\t\t\t\tpacket.payload.groups = [group];\n\t\t\t\t\tthis.publishBalancedEvent(packet, group);\n\t\t\t\t});\n\t\t\t\treturn this.broker.Promise.resolve();\n\t\t\t}\n\t\t\t// If it's not contain, then it is a broadcasted event,\n\t\t\t// we sent it in the normal way (exchange)\n\n\t\t} else if (packet.type === P.PACKET_REQUEST && packet.target == null) {\n\t\t\treturn this.publishBalancedRequest(packet);\n\t\t}\n\n\t\t// Normal packet publishing...\n\t\treturn this.publish(packet);\n\t}\n\n\t/**\n\t * Serialize the Packet to Buffer\n\t *\n\t * @param {Packet} packet\n\t * @returns {Buffer}\n\t *\n\t * @memberof Transit\n\t */\n\tserialize(packet) {\n\t\tpacket.payload.ver = this.broker.PROTOCOL_VERSION;\n\t\tpacket.payload.sender = this.nodeID;\n\t\treturn this.broker.serializer.serialize(packet.payload, packet.type);\n\t}\n\n\t/**\n\t * Deserialize the incoming Buffer to Packet\n\t *\n\t * @param {String} type\n\t * @param {Buffer} buf\n\t * @returns {Packet}\n\t *\n\t * @memberof Transit\n\t */\n\tdeserialize(type, buf) {\n\t\tif (buf == null) return null;\n\n\t\tconst msg = this.broker.serializer.deserialize(buf, type);\n\t\treturn new P.Packet(type, null, msg);\n\n\t}\n}\n\nmodule.exports = BaseTransporter;\n"],"names":["require$$0","require$$1","P"],"mappings":"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"}
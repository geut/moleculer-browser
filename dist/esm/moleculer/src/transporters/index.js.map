{"version":3,"file":"index.js","sources":["../../../../../src/moleculer/src/transporters/index.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { isObject, isString } = require(\"../utils\");\nconst { BrokerOptionsError } = require(\"../errors\");\n\nconst Transporters = {\n\tBase: require(\"./base\"),\n\tFake: require(\"./fake\"),\n\tNATS: require(\"./nats\"),\n\tMQTT: require(\"./mqtt\"),\n\tRedis: require(\"./redis\"),\n\tAMQP: require(\"./amqp\"),\n\tAMQP10: require(\"./amqp10\"),\n\tKafka: require(\"./kafka\"),\n\tSTAN: require(\"./stan\"),\n\tTCP: require(\"./tcp\")\n};\n\nfunction getByName(name) {\n\t/* istanbul ignore next */\n\tif (!name)\n\t\treturn null;\n\n\tlet n = Object.keys(Transporters).find(n => n.toLowerCase() == name.toLowerCase());\n\tif (n)\n\t\treturn Transporters[n];\n}\n\n/**\n * Resolve transporter by name\n *\n * @param {object|string} opt\n * @returns {Transporter}\n */\nfunction resolve(opt) {\n\tif (opt instanceof Transporters.Base) {\n\t\treturn opt;\n\t} else if (isString(opt)) {\n\t\tlet TransporterClass = getByName(opt);\n\t\tif (TransporterClass)\n\t\t\treturn new TransporterClass();\n\n\t\tif (opt.startsWith(\"nats://\"))\n\t\t\tTransporterClass = Transporters.NATS;\n\t\telse if (opt.startsWith(\"mqtt://\") || opt.startsWith(\"mqtts://\"))\n\t\t\tTransporterClass = Transporters.MQTT;\n\t\telse if (opt.startsWith(\"redis://\") || opt.startsWith(\"rediss://\"))\n\t\t\tTransporterClass = Transporters.Redis;\n\t\telse if (opt.startsWith(\"amqp://\") || opt.startsWith(\"amqps://\"))\n\t\t\tTransporterClass = Transporters.AMQP;\n\t\telse if (opt.startsWith(\"amqp10://\"))\n\t\t\tTransporterClass = Transporters.AMQP10;\n\t\telse if (opt.startsWith(\"kafka://\"))\n\t\t\tTransporterClass = Transporters.Kafka;\n\t\telse if (opt.startsWith(\"stan://\"))\n\t\t\tTransporterClass = Transporters.STAN;\n\t\telse if (opt.startsWith(\"tcp://\"))\n\t\t\tTransporterClass = Transporters.TCP;\n\n\t\tif (TransporterClass)\n\t\t\treturn new TransporterClass(opt);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid transporter type '${opt}'.`, { type: opt });\n\n\t} else if (isObject(opt)) {\n\t\tlet TransporterClass = getByName(opt.type || \"NATS\");\n\n\t\tif (TransporterClass)\n\t\t\treturn new TransporterClass(opt.options);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid transporter type '${opt.type}'.`, { type: opt.type });\n\t}\n\n\treturn null;\n}\n\nfunction register(name, value) {\n\tTransporters[name] = value;\n}\n\n\nmodule.exports = Object.assign(Transporters, { resolve, register });\n"],"names":["require$$0","require$$1","require$$2","require$$3","require$$4","require$$5","require$$6","require$$7","require$$8","require$$9","require$$10","require$$11"],"mappings":"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"}
{"version":3,"file":"fake.js","sources":["../../../../../src/moleculer/src/transporters/fake.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2019 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst Transporter \t= require(\"./base\");\n\nconst EventEmitter2 = require(\"eventemitter2\").EventEmitter2;\n\n// Put to global to transfer messages between brokers in the same process\nglobal.bus = new EventEmitter2({\n\twildcard: true,\n\tmaxListeners: 100\n});\n\n/**\n * Fake Transporter\n *\n * @class FakeTransporter\n * @extends {Transporter}\n */\nclass FakeTransporter extends Transporter {\n\n\t/**\n\t * Creates an instance of FakeTransporter.\n\t *\n\t * @param {any} opts\n\t *\n\t * @memberof FakeTransporter\n\t */\n\tconstructor(opts) {\n\t\tsuper(opts);\n\n\t\t// Local event bus\n\t\tthis.bus = global.bus;\n\t\tthis.hasBuiltInBalancer = true;\n\n\t\tthis.subscriptions = [];\n\t}\n\n\t/**\n\t * Connect to a NATS server\n\t *\n\t * @memberof FakeTransporter\n\t */\n\tconnect() {\n\t\treturn this.onConnected();\n\t}\n\n\t/**\n\t * Disconnect from a NATS server\n\t *\n\t * @memberof FakeTransporter\n\t */\n\tdisconnect() {\n\t\tthis.connected = false;\n\t\tthis.subscriptions.forEach(({ topic, handler }) => this.bus.off(topic, handler));\n\t\tthis.subscriptions = [];\n\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Subscribe to a command\n\t *\n\t * @param {String} cmd\n\t * @param {String} nodeID\n\t *\n\t * @memberof FakeTransporter\n\t */\n\tsubscribe(cmd, nodeID) {\n\t\tconst t = this.getTopicName(cmd, nodeID);\n\t\tconst handler = msg => this.receive(cmd, msg);\n\t\tthis.subscriptions.push({ topic: t, handler });\n\n\t\tthis.bus.on(t, handler);\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Subscribe to balanced action commands\n\t *\n\t * @param {String} action\n\t * @memberof AmqpTransporter\n\t */\n\tsubscribeBalancedRequest(/*action*/) {\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Subscribe to balanced event command\n\t *\n\t * @param {String} event\n\t * @param {String} group\n\t * @memberof AmqpTransporter\n\t */\n\tsubscribeBalancedEvent(/*event, group*/) {\n\t\treturn this.broker.Promise.resolve();\n\t}\n\n\t/**\n\t * Send data buffer.\n\t *\n\t * @param {String} topic\n\t * @param {Buffer} data\n\t * @param {Object} meta\n\t *\n\t * @returns {Promise}\n\t */\n\tsend(topic, data) {\n\t\tthis.bus.emit(topic, data);\n\t\treturn this.broker.Promise.resolve();\n\t}\n}\n\nmodule.exports = FakeTransporter;\n"],"names":["require$$0","global","Transporter"],"mappings":";;;;AAUA,MAAM,aAAa,GAAGA,EAAwB,CAAC,aAAa,CAAC;AAC7D;AACA;AACAC,cAAM,CAAC,GAAG,GAAG,IAAI,aAAa,CAAC;AAC/B,CAAC,QAAQ,EAAE,IAAI;AACf,CAAC,YAAY,EAAE,GAAG;AAClB,CAAC,CAAC,CAAC;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,eAAe,SAASC,IAAW,CAAC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,WAAW,CAAC,IAAI,EAAE;AACnB,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;AACd;AACA;AACA,EAAE,IAAI,CAAC,GAAG,GAAGD,cAAM,CAAC,GAAG,CAAC;AACxB,EAAE,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACjC;AACA,EAAE,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;AAC1B,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,OAAO,GAAG;AACX,EAAE,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC;AAC5B,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,UAAU,GAAG;AACd,EAAE,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;AACzB,EAAE,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC;AACnF,EAAE,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;AAC1B;AACA,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACvC,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,SAAS,CAAC,GAAG,EAAE,MAAM,EAAE;AACxB,EAAE,MAAM,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;AAC3C,EAAE,MAAM,OAAO,GAAG,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAChD,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;AACjD;AACA,EAAE,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;AAC1B,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACvC,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,wBAAwB,aAAa;AACtC,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACvC,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,sBAAsB,mBAAmB;AAC1C,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACvC,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE;AACnB,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AAC7B,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;AACvC,EAAE;AACF,CAAC;AACD;QACc,GAAG;;;;"}
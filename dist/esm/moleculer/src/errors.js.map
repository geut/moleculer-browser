{"version":3,"file":"errors.js","sources":["../../../../src/moleculer/src/errors.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst ExtendableError = require(\"es6-error\");\n\n/**\n * Custom Moleculer Error class\n *\n * @class MoleculerError\n * @extends {ExtendableError}\n */\nclass MoleculerError extends ExtendableError {\n\t/**\n\t * Creates an instance of MoleculerError.\n\t *\n\t * @param {String?} message\n\t * @param {Number?} code\n\t * @param {String?} type\n\t * @param {any} data\n\t *\n\t * @memberof MoleculerError\n\t */\n\tconstructor(message, code, type, data) {\n\t\tsuper(message);\n\t\tthis.code = code || 500;\n\t\tthis.type = type;\n\t\tthis.data = data;\n\t\tthis.retryable = false;\n\t}\n}\n\n/**\n * Custom Moleculer Error class for retryable errors.\n *\n * @class MoleculerRetryableError\n * @extends {MoleculerError}\n */\nclass MoleculerRetryableError extends MoleculerError {\n\t/**\n\t * Creates an instance of MoleculerRetryableError.\n\t *\n\t * @param {String?} message\n\t * @param {Number?} code\n\t * @param {String?} type\n\t * @param {any} data\n\t *\n\t * @memberof MoleculerRetryableError\n\t */\n\tconstructor(message, code, type, data) {\n\t\tsuper(message);\n\t\tthis.code = code || 500;\n\t\tthis.type = type;\n\t\tthis.data = data;\n\t\tthis.retryable = true;\n\t}\n}\n\n/**\n * Moleculer Error class for Broker disconnections which is retryable.\n *\n * @class MoleculerServerError\n * @extends {MoleculerRetryableError}\n */\nclass BrokerDisconnectedError extends MoleculerRetryableError {\n\tconstructor() {\n\t\tsuper(\"The broker's transporter has disconnected. Please try again when a connection is reestablished.\", 502, \"BAD_GATEWAY\");\n\t\t// Stack trace is hidden because it creates a lot of logs and, in this case, won't help users find the issue\n\t\tthis.stack = \"\";\n\t}\n}\n\n/**\n * Moleculer Error class for server error which is retryable.\n *\n * @class MoleculerServerError\n * @extends {MoleculerRetryableError}\n */\nclass MoleculerServerError extends MoleculerRetryableError {\n}\n\n/**\n * Moleculer Error class for client errors which is not retryable.\n *\n * @class MoleculerClientError\n * @extends {MoleculerError}\n */\nclass MoleculerClientError extends MoleculerError {\n\t/**\n\t * Creates an instance of MoleculerClientError.\n\t *\n\t * @param {String?} message\n\t * @param {Number?} code\n\t * @param {String?} type\n\t * @param {any} data\n\t *\n\t * @memberof MoleculerClientError\n\t */\n\tconstructor(message, code, type, data) {\n\t\tsuper(message, code || 400, type, data);\n\t}\n}\n\n\n/**\n * 'Service not found' Error message\n *\n * @class ServiceNotFoundError\n * @extends {MoleculerRetryableError}\n */\nclass ServiceNotFoundError extends MoleculerRetryableError {\n\t/**\n\t * Creates an instance of ServiceNotFoundError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof ServiceNotFoundError\n\t */\n\tconstructor(data = {}) {\n\t\tlet msg;\n\t\tif (data.nodeID && data.action)\n\t\t\tmsg = `Service '${data.action}' is not found on '${data.nodeID}' node.`;\n\t\telse if (data.action)\n\t\t\tmsg = `Service '${data.action}' is not found.`;\n\n\t\tif (data.service && data.version)\n\t\t\tmsg = `Service '${data.version}.${data.service}' not found.`;\n\t\telse if (data.service)\n\t\t\tmsg = `Service '${data.service}' not found.`;\n\n\t\tsuper(msg, 404, \"SERVICE_NOT_FOUND\", data);\n\t}\n}\n\n/**\n * 'Service not available' Error message\n *\n * @class ServiceNotAvailableError\n * @extends {MoleculerRetryableError}\n */\nclass ServiceNotAvailableError extends MoleculerRetryableError {\n\t/**\n\t * Creates an instance of ServiceNotAvailableError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof ServiceNotAvailableError\n\t */\n\tconstructor(data) {\n\t\tlet msg;\n\t\tif (data.nodeID)\n\t\t\tmsg = `Service '${data.action}' is not available on '${data.nodeID}' node.`;\n\t\telse\n\t\t\tmsg = `Service '${data.action}' is not available.`;\n\n\t\tsuper(msg, 404, \"SERVICE_NOT_AVAILABLE\", data);\n\t}\n}\n\n/**\n * 'Request timed out' Error message. Retryable.\n *\n * @class RequestTimeoutError\n * @extends {MoleculerRetryableError}\n */\nclass RequestTimeoutError extends MoleculerRetryableError {\n\t/**\n\t * Creates an instance of RequestTimeoutError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof RequestTimeoutError\n\t */\n\tconstructor(data) {\n\t\tsuper(`Request is timed out when call '${data.action}' action on '${data.nodeID}' node.`, 504, \"REQUEST_TIMEOUT\", data);\n\t}\n}\n\n/**\n * 'Request skipped for timeout' Error message\n *\n * @class RequestSkippedError\n * @extends {MoleculerError}\n */\nclass RequestSkippedError extends MoleculerError {\n\t/**\n\t * Creates an instance of RequestSkippedError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof RequestSkippedError\n\t */\n\tconstructor(data) {\n\t\tsuper(`Calling '${data.action}' is skipped because timeout reached on '${data.nodeID}' node.`, 514, \"REQUEST_SKIPPED\", data);\n\t\tthis.retryable = false;\n\t}\n}\n\n/**\n * 'Request rejected' Error message. Retryable.\n *\n * @class RequestRejectedError\n * @extends {MoleculerRetryableError}\n */\nclass RequestRejectedError extends MoleculerRetryableError {\n\t/**\n\t * Creates an instance of RequestRejectedError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof RequestRejectedError\n\t */\n\tconstructor(data) {\n\t\tsuper(`Request is rejected when call '${data.action}' action on '${data.nodeID}' node.`, 503, \"REQUEST_REJECTED\", data);\n\t}\n}\n\n/**\n * 'Queue is full' error message. Retryable.\n *\n * @class QueueIsFullError\n * @extends {MoleculerRetryableError}\n */\nclass QueueIsFullError extends MoleculerRetryableError {\n\t/**\n\t * Creates an instance of QueueIsFullError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof QueueIsFullError\n\t */\n\tconstructor(data) {\n\t\tsuper(`Queue is full. Request '${data.action}' action on '${data.nodeID}' node is rejected.`, 429, \"QUEUE_FULL\", data);\n\t}\n}\n\n/**\n * 'Parameters of action call validation error\n *\n * @class ValidationError\n * @extends {MoleculerClientError}\n */\nclass ValidationError extends MoleculerClientError {\n\t/**\n\t * Creates an instance of ValidationError.\n\t *\n\t * @param {String} message\n\t * @param {String} type\n\t * @param {any} data\n\t *\n\t * @memberof ValidationError\n\t */\n\tconstructor(message, type, data) {\n\t\tsuper(message, 422, type || \"VALIDATION_ERROR\", data);\n\t}\n}\n\n/**\n * 'Max request call level!' Error message\n *\n * @class MaxCallLevelError\n * @extends {MoleculerError}\n */\nclass MaxCallLevelError extends MoleculerError {\n\t/**\n\t * Creates an instance of MaxCallLevelError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof MaxCallLevelError\n\t */\n\tconstructor(data) {\n\t\tsuper(`Request level is reached the limit (${data.level}) on '${data.nodeID}' node.`, 500, \"MAX_CALL_LEVEL\", data);\n\t\tthis.retryable = false;\n\t}\n}\n\n/**\n * Custom Moleculer Error class for Service schema errors\n *\n * @class ServiceSchemaError\n * @extends {Error}\n */\nclass ServiceSchemaError extends MoleculerError {\n\t/**\n\t * Creates an instance of ServiceSchemaError.\n\t *\n\t * @param {String} msg\n\t * @param {Object} data\n\t * @memberof ServiceSchemaError\n\t */\n\tconstructor(msg, data) {\n\t\tsuper(msg, 500, \"SERVICE_SCHEMA_ERROR\", data);\n\t}\n}\n\n/**\n * Custom Moleculer Error class for broker option errors\n *\n * @class BrokerOptionsError\n * @extends {Error}\n */\nclass BrokerOptionsError extends MoleculerError {\n\t/**\n\t * Creates an instance of BrokerOptionsError.\n\t *\n\t * @param {String} msg\n\t * @param {Object} data\n\t * @memberof BrokerOptionsError\n\t */\n\tconstructor(msg, data) {\n\t\tsuper(msg, 500, \"BROKER_OPTIONS_ERROR\", data);\n\t}\n}\n\n/**\n * Custom Moleculer Error class for Graceful stopping\n *\n * @class GracefulStopTimeoutError\n * @extends {Error}\n */\nclass GracefulStopTimeoutError extends MoleculerError {\n\t/**\n\t * Creates an instance of GracefulStopTimeoutError.\n\t *\n\t * @param {Object?} data\n\t * @memberof GracefulStopTimeoutError\n\t */\n\tconstructor(data) {\n\t\tif (data && data.service)  {\n\t\t\tsuper(`Unable to stop '${data.service.name}' service gracefully.`, 500, \"GRACEFUL_STOP_TIMEOUT\", data && data.service ? {\n\t\t\t\tname: data.service.name,\n\t\t\t\tversion: data.service.version\n\t\t\t} : null);\n\t\t} else {\n\t\t\tsuper(\"Unable to stop ServiceBroker gracefully.\", 500, \"GRACEFUL_STOP_TIMEOUT\");\n\t\t}\n\t}\n}\n\n/**\n * Protocol version is mismatch\n *\n * @class ProtocolVersionMismatchError\n * @extends {Error}\n */\nclass ProtocolVersionMismatchError extends MoleculerError {\n\t/**\n\t * Creates an instance of ProtocolVersionMismatchError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof ProtocolVersionMismatchError\n\t */\n\tconstructor(data) {\n\t\tsuper(\"Protocol version mismatch.\", 500, \"PROTOCOL_VERSION_MISMATCH\", data);\n\t}\n}\n\n/**\n * Invalid packet format error\n *\n * @class InvalidPacketDataError\n * @extends {Error}\n */\nclass InvalidPacketDataError extends MoleculerError {\n\t/**\n\t * Creates an instance of InvalidPacketDataError.\n\t *\n\t * @param {Object} data\n\t *\n\t * @memberof InvalidPacketDataError\n\t */\n\tconstructor(data) {\n\t\tsuper(\"Invalid packet data.\", 500, \"INVALID_PACKET_DATA\", data);\n\t}\n}\n\n/**\n * Recreate an error from a transferred payload `err`\n *\n * @param {Error} err\n * @returns {MoleculerError}\n */\nfunction recreateError(err) {\n\tconst Class = module.exports[err.name];\n\tif (Class) {\n\t\tswitch(err.name) {\n\t\t\tcase \"MoleculerError\": return new Class(err.message, err.code, err.type, err.data);\n\t\t\tcase \"MoleculerRetryableError\": return new Class(err.message, err.code, err.type, err.data);\n\t\t\tcase \"MoleculerServerError\": return new Class(err.message, err.code, err.type, err.data);\n\t\t\tcase \"MoleculerClientError\": return new Class(err.message, err.code, err.type, err.data);\n\n\t\t\tcase \"ValidationError\": return new Class(err.message, err.type, err.data);\n\n\t\t\tcase \"ServiceNotFoundError\": return new Class(err.data);\n\t\t\tcase \"ServiceNotAvailableError\": return new Class(err.data);\n\t\t\tcase \"RequestTimeoutError\": return new Class(err.data);\n\t\t\tcase \"RequestSkippedError\": return new Class(err.data);\n\t\t\tcase \"RequestRejectedError\": return new Class(err.data);\n\t\t\tcase \"QueueIsFullError\": return new Class(err.data);\n\t\t\tcase \"MaxCallLevelError\": return new Class(err.data);\n\t\t\tcase \"GracefulStopTimeoutError\": return new Class(err.data);\n\t\t\tcase \"ProtocolVersionMismatchError\": return new Class(err.data);\n\t\t\tcase \"InvalidPacketDataError\": return new Class(err.data);\n\n\t\t\tcase \"ServiceSchemaError\":\n\t\t\tcase \"BrokerOptionsError\": return new Class(err.message, err.data);\n\t\t}\n\t}\n}\n\n\nmodule.exports = {\n\tMoleculerError,\n\tMoleculerRetryableError,\n\tMoleculerServerError,\n\tMoleculerClientError,\n\n\tServiceNotFoundError,\n\tServiceNotAvailableError,\n\n\tValidationError,\n\tRequestTimeoutError,\n\tRequestSkippedError,\n\tRequestRejectedError,\n\tQueueIsFullError,\n\tMaxCallLevelError,\n\n\tServiceSchemaError,\n\tBrokerOptionsError,\n\tGracefulStopTimeoutError,\n\n\tProtocolVersionMismatchError,\n\tInvalidPacketDataError,\n\n\tBrokerDisconnectedError,\n\n\trecreateError\n};\n"],"names":["MoleculerError","ExtendableError","[object Object]","message","code","type","data","super","this","retryable","MoleculerRetryableError","MoleculerClientError","module","MoleculerServerError","ServiceNotFoundError","msg","nodeID","action","service","version","ServiceNotAvailableError","ValidationError","RequestTimeoutError","RequestSkippedError","RequestRejectedError","QueueIsFullError","MaxCallLevelError","level","ServiceSchemaError","BrokerOptionsError","GracefulStopTimeoutError","name","ProtocolVersionMismatchError","InvalidPacketDataError","BrokerDisconnectedError","stack","recreateError","err","Class","exports"],"mappings":"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"}
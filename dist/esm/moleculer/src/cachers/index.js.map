{"version":3,"file":"index.js","sources":["../../../../../src/moleculer/src/cachers/index.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { isObject, isString } = require(\"../utils\");\nconst { BrokerOptionsError } = require(\"../errors\");\n\nconst Cachers = {\n\tBase: require(\"./base\"),\n\tMemory: require(\"./memory\"),\n\tMemoryLRU: require(\"./memory-lru\"),\n\tRedis: require(\"./redis\")\n};\n\nfunction getByName(name) {\n\t/* istanbul ignore next */\n\tif (!name)\n\t\treturn null;\n\n\tlet n = Object.keys(Cachers).find(n => n.toLowerCase() == name.toLowerCase());\n\tif (n)\n\t\treturn Cachers[n];\n}\n\n/**\n * Resolve cacher by name\n *\n * @param {object|string} opt\n * @returns {Cacher}\n */\nfunction resolve(opt) {\n\tif (opt instanceof Cachers.Base) {\n\t\treturn opt;\n\t} else if (opt === true) {\n\t\treturn new Cachers.Memory();\n\t} else if (isString(opt)) {\n\t\tlet CacherClass = getByName(opt);\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass();\n\n\t\tif (opt.startsWith(\"redis://\"))\n\t\t\tCacherClass = Cachers.Redis;\n\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass(opt);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid cacher type '${opt}'.`, { type: opt });\n\n\t} else if (isObject(opt)) {\n\t\tlet CacherClass = getByName(opt.type || \"Memory\");\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass(opt.options);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid cacher type '${opt.type}'.`, { type: opt.type });\n\t}\n\n\treturn null;\n}\n\nfunction register(name, value) {\n\tCachers[name] = value;\n}\n\nmodule.exports = Object.assign(Cachers, { resolve, register });\n\n"],"names":["isObject","isString","require$$0","BrokerOptionsError","require$$1","Cachers","Base","require$$2","Memory","require$$3","MemoryLRU","require$$4","Redis","require$$5","getByName","name","n","Object","keys","find","toLowerCase","assign","resolve","opt","CacherClass","startsWith","type","options","register","value"],"mappings":"6KAQA,MAAMA,SAAEA,EAAQC,SAAEA,GAAaC,GACzBC,mBAAEA,GAAuBC,EAEzBC,EAAU,CACfC,KAAMC,EACNC,OAAQC,EACRC,UAAWC,EACXC,MAAOC,GAGR,SAASC,EAAUC,GAElB,IAAKA,EACJ,OAAO,KAER,IAAIC,EAAIC,OAAOC,KAAKb,GAASc,MAAKH,GAAKA,EAAEI,eAAiBL,EAAKK,gBAC/D,OAAIJ,EACIX,EAAQW,QADhB,QA2CgBC,OAAOI,OAAOhB,EAAS,CAAEiB,QAjC1C,SAAiBC,GAChB,GAAIA,aAAelB,EAAQC,KAC1B,OAAOiB,EACD,IAAY,IAARA,EACV,OAAO,IAAIlB,EAAQG,OACb,GAAIP,EAASsB,GAAM,CACzB,IAAIC,EAAcV,EAAUS,GAC5B,GAAIC,EACH,OAAO,IAAIA,EAKZ,GAHID,EAAIE,WAAW,cAClBD,EAAcnB,EAAQO,OAEnBY,EACH,OAAO,IAAIA,EAAYD,GAEvB,MAAM,IAAIpB,EAAmB,wBAAwBoB,MAAS,CAAEG,KAAMH,IAEjE,GAAIvB,EAASuB,GAAM,CACzB,IAAIC,EAAcV,EAAUS,EAAIG,MAAQ,UACxC,GAAIF,EACH,OAAO,IAAIA,EAAYD,EAAII,SAE3B,MAAM,IAAIxB,EAAmB,wBAAwBoB,EAAIG,SAAU,CAAEA,KAAMH,EAAIG,OAGjF,OAAO,MAO2CE,SAJnD,SAAkBb,EAAMc,GACvBxB,EAAQU,GAAQc"}
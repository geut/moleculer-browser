{"version":3,"file":"index.js","sources":["../../../../../src/moleculer/src/cachers/index.js"],"sourcesContent":["/*\n * moleculer\n * Copyright (c) 2018 MoleculerJS (https://github.com/moleculerjs/moleculer)\n * MIT Licensed\n */\n\n\"use strict\";\n\nconst { isObject, isString } = require(\"../utils\");\nconst { BrokerOptionsError } = require(\"../errors\");\n\nconst Cachers = {\n\tBase: require(\"./base\"),\n\tMemory: require(\"./memory\"),\n\tMemoryLRU: require(\"./memory-lru\"),\n\tRedis: require(\"./redis\")\n};\n\nfunction getByName(name) {\n\t/* istanbul ignore next */\n\tif (!name)\n\t\treturn null;\n\n\tlet n = Object.keys(Cachers).find(n => n.toLowerCase() == name.toLowerCase());\n\tif (n)\n\t\treturn Cachers[n];\n}\n\n/**\n * Resolve cacher by name\n *\n * @param {object|string} opt\n * @returns {Cacher}\n */\nfunction resolve(opt) {\n\tif (opt instanceof Cachers.Base) {\n\t\treturn opt;\n\t} else if (opt === true) {\n\t\treturn new Cachers.Memory();\n\t} else if (isString(opt)) {\n\t\tlet CacherClass = getByName(opt);\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass();\n\n\t\tif (opt.startsWith(\"redis://\"))\n\t\t\tCacherClass = Cachers.Redis;\n\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass(opt);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid cacher type '${opt}'.`, { type: opt });\n\n\t} else if (isObject(opt)) {\n\t\tlet CacherClass = getByName(opt.type || \"Memory\");\n\t\tif (CacherClass)\n\t\t\treturn new CacherClass(opt.options);\n\t\telse\n\t\t\tthrow new BrokerOptionsError(`Invalid cacher type '${opt.type}'.`, { type: opt.type });\n\t}\n\n\treturn null;\n}\n\nfunction register(name, value) {\n\tCachers[name] = value;\n}\n\nmodule.exports = Object.assign(Cachers, { resolve, register });\n\n"],"names":["require$$0","require$$1","require$$2","require$$3","require$$4","require$$5"],"mappings":";;;;;;;AAQA,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAGA,OAAmB,CAAC;AACnD,MAAM,EAAE,kBAAkB,EAAE,GAAGC,MAAoB,CAAC;AACpD;AACA,MAAM,OAAO,GAAG;AAChB,CAAC,IAAI,EAAEC,IAAiB;AACxB,CAAC,MAAM,EAAEC,MAAmB;AAC5B,CAAC,SAAS,EAAEC,SAAuB;AACnC,CAAC,KAAK,EAAEC,WAAkB;AAC1B,CAAC,CAAC;AACF;AACA,SAAS,SAAS,CAAC,IAAI,EAAE;AACzB;AACA,CAAC,IAAI,CAAC,IAAI;AACV,EAAE,OAAO,IAAI,CAAC;AACd;AACA,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;AAC/E,CAAC,IAAI,CAAC;AACN,EAAE,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC;AACpB,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,OAAO,CAAC,GAAG,EAAE;AACtB,CAAC,IAAI,GAAG,YAAY,OAAO,CAAC,IAAI,EAAE;AAClC,EAAE,OAAO,GAAG,CAAC;AACb,EAAE,MAAM,IAAI,GAAG,KAAK,IAAI,EAAE;AAC1B,EAAE,OAAO,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;AAC9B,EAAE,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B,EAAE,IAAI,WAAW,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC;AACnC,EAAE,IAAI,WAAW;AACjB,GAAG,OAAO,IAAI,WAAW,EAAE,CAAC;AAC5B;AACA,EAAE,IAAI,GAAG,CAAC,UAAU,CAAC,UAAU,CAAC;AAChC,GAAG,WAAW,GAAG,OAAO,CAAC,KAAK,CAAC;AAC/B;AACA,EAAE,IAAI,WAAW;AACjB,GAAG,OAAO,IAAI,WAAW,CAAC,GAAG,CAAC,CAAC;AAC/B;AACA,GAAG,MAAM,IAAI,kBAAkB,CAAC,CAAC,qBAAqB,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AAChF;AACA,EAAE,MAAM,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B,EAAE,IAAI,WAAW,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,IAAI,QAAQ,CAAC,CAAC;AACpD,EAAE,IAAI,WAAW;AACjB,GAAG,OAAO,IAAI,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACvC;AACA,GAAG,MAAM,IAAI,kBAAkB,CAAC,CAAC,qBAAqB,EAAE,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;AAC1F,EAAE;AACF;AACA,CAAC,OAAO,IAAI,CAAC;AACb,CAAC;AACD;AACA,SAAS,QAAQ,CAAC,IAAI,EAAE,KAAK,EAAE;AAC/B,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;AACvB,CAAC;AACD;WACc,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE;;;;"}